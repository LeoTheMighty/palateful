module.exports=[17374,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={ActionDidNotRevalidate:function(){return i},ActionDidRevalidateDynamicOnly:function(){return o},ActionDidRevalidateStaticAndDynamic:function(){return s}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let i=0,s=1,o=2},30240,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={MutableRequestCookiesAdapter:function(){return f},ReadonlyRequestCookiesError:function(){return u},RequestCookiesAdapter:function(){return l},appendMutableCookies:function(){return p},areCookiesMutableInCurrentPhase:function(){return m},createCookiesWithMutableAccessCheck:function(){return y},getModifiedCookieValues:function(){return h},responseCookiesToRequestCookies:function(){return g}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let i=e.r(472),s=e.r(30759),o=e.r(56704),c=e.r(17374);class u extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new u}}class l{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return u.callable;default:return s.ReflectAdapter.get(e,t,r)}}})}}let d=Symbol.for("next.mutated.cookies");function h(e){let t=e[d];return t&&Array.isArray(t)&&0!==t.length?t:[]}function p(e,t){let r=h(t);if(0===r.length)return!1;let n=new i.ResponseCookies(e),a=n.getAll();for(let e of r)n.set(e);for(let e of a)n.set(e);return!0}class f{static wrap(e,t){let r=new i.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let n=[],a=new Set,u=()=>{let e=o.workAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=c.ActionDidRevalidateStaticAndDynamic),n=r.getAll().filter(e=>a.has(e.name)),t){let e=[];for(let t of n){let r=new i.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}},l=new Proxy(r,{get(e,t,r){switch(t){case d:return n;case"delete":return function(...t){a.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.delete(...t),l}finally{u()}};case"set":return function(...t){a.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t),l}finally{u()}};default:return s.ReflectAdapter.get(e,t,r)}}});return l}}function y(e){let t=new Proxy(e.mutableCookies,{get(r,n,a){switch(n){case"delete":return function(...n){return w(e,"cookies().delete"),r.delete(...n),t};case"set":return function(...n){return w(e,"cookies().set"),r.set(...n),t};default:return s.ReflectAdapter.get(r,n,a)}}});return t}function m(e){return"action"===e.phase}function w(e,t){if(!m(e))throw new u}function g(e){let t=new i.RequestCookies(new Headers);for(let r of e.getAll())t.set(r);return t}},13884,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return c}});let n=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var o=i?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(n,s,o):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(e.r(47540));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}let i={current:null},s="function"==typeof n.cache?n.cache:e=>e,o=console.warn;function c(e){return function(...t){o(e(...t))}}s(e=>{try{o(i.current)}finally{i.current=null}})},7460,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"cookies",{enumerable:!0,get:function(){return p}});let n=e.r(30240),a=e.r(472),i=e.r(56704),s=e.r(32319),o=e.r(68665),c=e.r(97573),u=e.r(4642),l=e.r(13884),d=e.r(43824),h=e.r(76414);function p(){let e="cookies",t=i.workAsyncStorage.getStore(),r=s.workUnitAsyncStorage.getStore();if(t){if(r&&"after"===r.phase&&!(0,d.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`cookies()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E843",enumerable:!1,configurable:!0});if(t.forceStatic)return y(n.RequestCookiesAdapter.seal(new a.RequestCookies(new Headers({}))));if(t.dynamicShouldError)throw Object.defineProperty(new c.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E849",enumerable:!1,configurable:!0});if(r)switch(r.type){case"cache":let i=Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E831",enumerable:!1,configurable:!0});throw Error.captureStackTrace(i,p),t.invalidDynamicUsageError??=i,i;case"unstable-cache":throw Object.defineProperty(Error(`Route ${t.route} used \`cookies()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E846",enumerable:!1,configurable:!0});case"prerender":var l=t,m=r;let s=f.get(m);if(s)return s;let w=(0,u.makeHangingPromise)(m.renderSignal,l.route,"`cookies()`");return f.set(m,w),w;case"prerender-client":let g="`cookies`";throw Object.defineProperty(new h.InvariantError(`${g} must not be used within a Client Component. Next.js should be preventing ${g} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,o.postponeWithTracking)(t.route,e,r.dynamicTracking);case"prerender-legacy":return(0,o.throwToInterruptStaticGeneration)(e,t,r);case"prerender-runtime":return(0,o.delayUntilRuntimeStage)(r,y(r.cookies));case"private-cache":return y(r.cookies);case"request":return(0,o.trackDynamicDataInDynamicRender)(r),y((0,n.areCookiesMutableInCurrentPhase)(r)?r.userspaceMutableCookies:r.cookies)}}(0,s.throwForMissingRequestStore)(e)}e.r(18185);let f=new WeakMap;function y(e){let t=f.get(e);if(t)return t;let r=Promise.resolve(e);return f.set(e,r),r}(0,l.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E830",enumerable:!1,configurable:!0})})},36052,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={HeadersAdapter:function(){return o},ReadonlyHeadersError:function(){return s}};for(var a in n)Object.defineProperty(r,a,{enumerable:!0,get:n[a]});let i=e.r(30759);class s extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new s}}class o extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,n){if("symbol"==typeof r)return i.ReflectAdapter.get(t,r,n);let a=r.toLowerCase(),s=Object.keys(e).find(e=>e.toLowerCase()===a);if(void 0!==s)return i.ReflectAdapter.get(t,s,n)},set(t,r,n,a){if("symbol"==typeof r)return i.ReflectAdapter.set(t,r,n,a);let s=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===s);return i.ReflectAdapter.set(t,o??r,n,a)},has(t,r){if("symbol"==typeof r)return i.ReflectAdapter.has(t,r);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0!==a&&i.ReflectAdapter.has(t,a)},deleteProperty(t,r){if("symbol"==typeof r)return i.ReflectAdapter.deleteProperty(t,r);let n=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0===a||i.ReflectAdapter.deleteProperty(t,a)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return s.callable;default:return i.ReflectAdapter.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new o(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},19971,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"headers",{enumerable:!0,get:function(){return h}});let n=e.r(36052),a=e.r(56704),i=e.r(32319),s=e.r(68665),o=e.r(97573),c=e.r(4642),u=e.r(13884),l=e.r(43824),d=e.r(76414);function h(){let e="headers",t=a.workAsyncStorage.getStore(),r=i.workUnitAsyncStorage.getStore();if(t){if(r&&"after"===r.phase&&!(0,l.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`headers()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E839",enumerable:!1,configurable:!0});if(t.forceStatic)return f(n.HeadersAdapter.seal(new Headers({})));if(r)switch(r.type){case"cache":{let e=Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E833",enumerable:!1,configurable:!0});throw Error.captureStackTrace(e,h),t.invalidDynamicUsageError??=e,e}case"unstable-cache":throw Object.defineProperty(Error(`Route ${t.route} used \`headers()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E838",enumerable:!1,configurable:!0})}if(t.dynamicShouldError)throw Object.defineProperty(new o.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`headers()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E828",enumerable:!1,configurable:!0});if(r)switch(r.type){case"prerender":var u=t,y=r;let a=p.get(y);if(a)return a;let i=(0,c.makeHangingPromise)(y.renderSignal,u.route,"`headers()`");return p.set(y,i),i;case"prerender-client":let m="`headers`";throw Object.defineProperty(new d.InvariantError(`${m} must not be used within a client component. Next.js should be preventing ${m} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,s.postponeWithTracking)(t.route,e,r.dynamicTracking);case"prerender-legacy":return(0,s.throwToInterruptStaticGeneration)(e,t,r);case"prerender-runtime":return(0,s.delayUntilRuntimeStage)(r,f(r.headers));case"private-cache":return f(r.headers);case"request":return(0,s.trackDynamicDataInDynamicRender)(r),f(r.headers)}}(0,i.throwForMissingRequestStore)(e)}e.r(18185);let p=new WeakMap;function f(e){let t=p.get(e);if(t)return t;let r=Promise.resolve(e);return p.set(e,r),r}(0,u.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`headers()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E836",enumerable:!1,configurable:!0})})},21423,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"draftMode",{enumerable:!0,get:function(){return l}});let n=e.r(32319),a=e.r(56704),i=e.r(68665),s=e.r(13884),o=e.r(97573),c=e.r(65252),u=e.r(76414);function l(){let e=a.workAsyncStorage.getStore(),t=n.workUnitAsyncStorage.getStore();switch((!e||!t)&&(0,n.throwForMissingRequestStore)("draftMode"),t.type){case"prerender-runtime":return(0,i.delayUntilRuntimeStage)(t,d(t.draftMode,e));case"request":return d(t.draftMode,e);case"cache":case"private-cache":case"unstable-cache":let r=(0,n.getDraftModeProviderForCacheScope)(e,t);if(r)return d(r,e);case"prerender":case"prerender-client":case"prerender-ppr":case"prerender-legacy":return d(null,e);default:return t}}function d(e,t){let r=p.get(e??h);return r||Promise.resolve(new f(e))}e.r(30759);let h={},p=new WeakMap;class f{constructor(e){this._provider=e}get isEnabled(){return null!==this._provider&&this._provider.isEnabled}enable(){y("draftMode().enable()",this.enable),null!==this._provider&&this._provider.enable()}disable(){y("draftMode().disable()",this.disable),null!==this._provider&&this._provider.disable()}}function y(e,t){let r=a.workAsyncStorage.getStore(),s=n.workUnitAsyncStorage.getStore();if(r){if((null==s?void 0:s.phase)==="after")throw Object.defineProperty(Error(`Route ${r.route} used "${e}" inside \`after()\`. The enabled status of \`draftMode()\` can be read inside \`after()\` but you cannot enable or disable \`draftMode()\`. See more info here: https://nextjs.org/docs/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E845",enumerable:!1,configurable:!0});if(r.dynamicShouldError)throw Object.defineProperty(new o.StaticGenBailoutError(`Route ${r.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E553",enumerable:!1,configurable:!0});if(s)switch(s.type){case"cache":case"private-cache":{let n=Object.defineProperty(Error(`Route ${r.route} used "${e}" inside "use cache". The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E829",enumerable:!1,configurable:!0});throw Error.captureStackTrace(n,t),r.invalidDynamicUsageError??=n,n}case"unstable-cache":throw Object.defineProperty(Error(`Route ${r.route} used "${e}" inside a function cached with \`unstable_cache()\`. The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E844",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":{let t=Object.defineProperty(Error(`Route ${r.route} used ${e} without first calling \`await connection()\`. See more info here: https://nextjs.org/docs/messages/next-prerender-sync-headers`),"__NEXT_ERROR_CODE",{value:"E126",enumerable:!1,configurable:!0});return(0,i.abortAndThrowOnSynchronousRequestDataAccess)(r.route,e,t,s)}case"prerender-client":let n="`draftMode`";throw Object.defineProperty(new u.InvariantError(`${n} must not be used within a Client Component. Next.js should be preventing ${n} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,i.postponeWithTracking)(r.route,e,s.dynamicTracking);case"prerender-legacy":s.revalidate=0;let a=Object.defineProperty(new c.DynamicServerError(`Route ${r.route} couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw r.dynamicUsageDescription=e,r.dynamicUsageStack=a.stack,a;case"request":(0,i.trackDynamicDataInDynamicRender)(s)}}}(0,s.createDedupedByCallsiteServerErrorLoggerDev)(function(e,t){let r=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${r}used ${t}. \`draftMode()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E835",enumerable:!1,configurable:!0})})},93458,(e,t,r)=>{t.exports.cookies=e.r(7460).cookies,t.exports.headers=e.r(19971).headers,t.exports.draftMode=e.r(21423).draftMode},18422,98043,e=>{"use strict";let t,r,n,a,i,s,o,c,u,l;var d,h,p,f,y,m,w,g,b,S,E,A,k,_,v,T,P,C,R,O,x,I=e.i(93458),D=e.i(89171);class H extends Error{}class U extends H{constructor({code:e,message:t}){super(t??"An error occurred while interacting with the authorization server."),this.name="OAuth2Error",this.code=e}}class K extends H{constructor(e){super(e??"Discovery failed for the OpenID Connect configuration."),this.code="discovery_error",this.name="DiscoveryError"}}class N extends H{constructor(e){super(e??"The state parameter is missing."),this.code="missing_state",this.name="MissingStateError"}}class M extends H{constructor(e){super(e??"The state parameter is invalid."),this.code="invalid_state",this.name="InvalidStateError"}}class j extends H{constructor(e){super(e??"The configuration is invalid."),this.code="invalid_configuration",this.name="InvalidConfigurationError"}}class W extends H{constructor({cause:e,message:t}){super(t??"An error occurred during the authorization flow."),this.code="authorization_error",this.cause=e,this.name="AuthorizationError"}}class L extends H{constructor(e){super(e??"An error occurred while preparing or performing the authorization code grant request."),this.code="authorization_code_grant_request_error",this.name="AuthorizationCodeGrantRequestError"}}class $ extends H{constructor({cause:e,message:t}){super(t??"An error occurred while trying to exchange the authorization code."),this.code="authorization_code_grant_error",this.cause=e,this.name="AuthorizationCodeGrantError"}}class J extends H{constructor(e){super(e??"An error occurred while completing the backchannel logout request."),this.code="backchannel_logout_error",this.name="BackchannelLogoutError"}}class q extends H{constructor(){super("The authorization server does not support backchannel authentication. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-client-initiated-backchannel-authentication"),this.code="backchannel_authentication_not_supported_error",this.name="BackchannelAuthenticationNotSupportedError"}}class z extends H{constructor({cause:e}){super("There was an error when trying to use Client-Initiated Backchannel Authentication."),this.code="backchannel_authentication_error",this.cause=e,this.name="BackchannelAuthenticationError"}}(d=g||(g={})).MISSING_SESSION="missing_session",d.MISSING_REFRESH_TOKEN="missing_refresh_token",d.FAILED_TO_REFRESH_TOKEN="failed_to_refresh_token";class B extends H{constructor(e,t,r){super(t),this.name="AccessTokenError",this.code=e,this.cause=r}}(h=b||(b={})).MISSING_SESSION="missing_session",h.MISSING_REFRESH_TOKEN="missing_refresh_token",h.FAILED_TO_EXCHANGE="failed_to_exchange_refresh_token";class F extends H{constructor(e,t,r){super(t),this.name="AccessTokenForConnectionError",this.code=e,this.cause=r}}(p=S||(S={})).MISSING_SUBJECT_TOKEN="missing_subject_token",p.INVALID_SUBJECT_TOKEN_TYPE="invalid_subject_token_type",p.MISSING_ACTOR_TOKEN_TYPE="missing_actor_token_type",p.EXCHANGE_FAILED="exchange_failed";class G extends H{constructor(e,t,r){super(t),this.name="CustomTokenExchangeError",this.code=e,this.cause=r}}(f=E||(E={})).DPOP_JKT_CALCULATION_FAILED="dpop_jkt_calculation_failed",f.DPOP_KEY_EXPORT_FAILED="dpop_key_export_failed",f.DPOP_CONFIGURATION_ERROR="dpop_configuration_error";class V extends H{constructor(e,t,r){super(t),this.name="DPoPError",this.code=e,this.cause=r}}class X extends H{constructor({type:e,title:t,detail:r,status:n,validationErrors:a}){super(`${t}: ${r}`),this.name="MyAccountApiError",this.code="my_account_api_error",this.type=e,this.title=t,this.detail=r,this.status=n,this.validationErrors=a}}(y=A||(A={})).MISSING_SESSION="missing_session",y.FAILED_TO_INITIATE="failed_to_initiate",y.FAILED_TO_COMPLETE="failed_to_complete";class Y extends H{constructor({code:e,message:t,cause:r}){super(t),this.name="ConnectAccountError",this.code=e,this.cause=r}}let Z="openid profile email offline_access";var Q=e.i(54799);function ee(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(t="oauth4webapi/v3.8.3");let et="ERR_INVALID_ARG_VALUE",er="ERR_INVALID_ARG_TYPE";function en(e,t,r){let n=TypeError(e,{cause:r});return Object.assign(n,{code:t}),n}let ea=Symbol(),ei=Symbol(),es=Symbol(),eo=Symbol(),ec=Symbol(),eu=Symbol();Symbol();let el=new TextEncoder,ed=new TextDecoder;function eh(e){return"string"==typeof e?el.encode(e):ed.decode(e)}function ep(e){return"string"==typeof e?n(e):r(e)}r=Uint8Array.prototype.toBase64?e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0})):e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},n=Uint8Array.fromBase64?e=>{try{return Uint8Array.fromBase64(e,{alphabet:"base64url"})}catch(e){throw en("The input to be decoded is not correctly encoded.",et,e)}}:e=>{try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch(e){throw en("The input to be decoded is not correctly encoded.",et,e)}};class ef extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=tk,Error.captureStackTrace?.(this,this.constructor)}}class ey extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,t?.code&&(this.code=t?.code),Error.captureStackTrace?.(this,this.constructor)}}function em(e,t,r){return new ey(e,{code:t,cause:r})}async function ew(e){let t;switch(e.kty){case"EC":t={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":t={crv:e.crv,kty:e.kty,x:e.x};break;case"AKP":t={alg:e.alg,kty:e.kty,pub:e.pub};break;case"RSA":t={e:e.e,kty:e.kty,n:e.n};break;default:throw new ef("unsupported JWK key type",{cause:e})}return ep(await crypto.subtle.digest("SHA-256",eh(JSON.stringify(t))))}function eg(e,t){if(!(e instanceof CryptoKey))throw en(`${t} must be a CryptoKey`,er)}function eb(e,t){if(eg(e,t),"private"!==e.type)throw en(`${t} must be a private CryptoKey`,et)}function eS(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function eE(e){ee(e,Headers)&&(e=Object.fromEntries(e.entries()));let r=new Headers(e??{});if(t&&!r.has("user-agent")&&r.set("user-agent",t),r.has("authorization"))throw en('"options.headers" must not include the "authorization" header name',et);return r}function eA(e,t){if(void 0!==t){if("function"==typeof t&&(t=t(e.href)),!(t instanceof AbortSignal))throw en('"options.signal" must return or be an instance of AbortSignal',er);return t}}function ek(e){return e.includes("//")?e.replace("//","/"):e}async function e_(e,t,r,n){if(!(e instanceof URL))throw en(`"${t}" must be an instance of URL`,er);eJ(e,n?.[ea]!==!0);let a=r(new URL(e.href)),i=eE(n?.headers);return i.set("accept","application/json"),(n?.[eo]||fetch)(a.href,{body:void 0,headers:Object.fromEntries(i.entries()),method:"GET",redirect:"manual",signal:eA(a,n?.signal)})}async function ev(e,t){return e_(e,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":e.pathname=ek(`${e.pathname}/.well-known/openid-configuration`);break;case"oauth2":!function(e,t,r=!1){"/"===e.pathname?e.pathname=t:e.pathname=ek(`${t}/${r?e.pathname:e.pathname.replace(/(\/)$/,"")}`)}(e,".well-known/oauth-authorization-server");break;default:throw en('"options.algorithm" must be "oidc" (default), or "oauth2"',et)}return e},t)}function eT(e,t,r,n,a){try{if("number"!=typeof e||!Number.isFinite(e))throw en(`${r} must be a number`,er,a);if(e>0)return;if(t){if(0!==e)throw en(`${r} must be a non-negative number`,et,a);return}throw en(`${r} must be a positive number`,et,a)}catch(e){if(n)throw em(e.message,n,a);throw e}}function eP(e,t,r,n){try{if("string"!=typeof e)throw en(`${t} must be a string`,er,n);if(0===e.length)throw en(`${t} must not be empty`,et,n)}catch(e){if(r)throw em(e.message,r,n);throw e}}async function eC(e,t){if(!(e instanceof URL)&&e!==tX)throw en('"expectedIssuerIdentifier" must be an instance of URL',er);if(!ee(t,Response))throw en('"response" must be an instance of Response',er);if(200!==t.status)throw em('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',tC,t);tM(t);let r=await tV(t);if(eP(r.issuer,'"response" body "issuer" property',tT,{body:r}),e!==tX&&new URL(r.issuer).href!==e.href)throw em('"response" body "issuer" property does not match the expected value',tD,{expected:e.href,body:r,attribute:"issuer"});return r}function eR(e){var t,r=e,n="application/json";if(t=r,t.headers.get("content-type")?.split(";")[0]!==n)throw function(e,...t){let r='"response" content-type must be ';if(t.length>2){let e=t.pop();r+=`${t.join(", ")}, or ${e}`}else 2===t.length?r+=`${t[0]} or ${t[1]}`:r+=t[0];return em(r,tP,e)}(r,n)}function eO(){return ep(crypto.getRandomValues(new Uint8Array(32)))}async function ex(e){return eP(e,"codeVerifier"),ep(await crypto.subtle.digest("SHA-256",eh(e)))}function eI(e){switch(e.algorithm.name){case"RSA-PSS":switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new ef("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new ef("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}case"ECDSA":switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new ef("unsupported EcKeyAlgorithm namedCurve",{cause:e})}case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return e.algorithm.name;case"EdDSA":return"Ed25519";default:throw new ef("unsupported CryptoKey algorithm name",{cause:e})}}function eD(e){let t=e?.[ei];return"number"==typeof t&&Number.isFinite(t)?t:0}function eH(e){let t=e?.[es];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function eU(){return Math.floor(Date.now()/1e3)}function eK(e){if("object"!=typeof e||null===e)throw en('"as" must be an object',er);eP(e.issuer,'"as.issuer"')}function eN(e){if("object"!=typeof e||null===e)throw en('"client" must be an object',er);eP(e.client_id,'"client.client_id"')}function eM(e){return eP(e,'"clientSecret"'),(t,r,n,a)=>{n.set("client_id",r.client_id),n.set("client_secret",e)}}async function ej(e,t,r){if(!r.usages.includes("sign"))throw en('CryptoKey instances used for signing assertions must include "sign" in their "usages"',et);let n=`${ep(eh(JSON.stringify(e)))}.${ep(eh(JSON.stringify(t)))}`,a=ep(await crypto.subtle.sign(function(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){let{algorithm:t}=e;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new ef("unsupported ECDSA namedCurve",{cause:e})}}(e)};case"RSA-PSS":switch(tj(e),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new ef("unsupported RSA-PSS hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":return tj(e),e.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return e.algorithm.name}throw new ef("unsupported CryptoKey algorithm name",{cause:e})}(r),r,eh(n)));return`${n}.${a}`}async function eW(e,t){let{kty:r,e:n,n:i,x:s,y:o,crv:c,pub:u}=await crypto.subtle.exportKey("jwk",e),l={kty:r,e:n,n:i,x:s,y:o,crv:c,pub:u};return"AKP"===r&&(l.alg=t),a.set(e,l),l}async function eL(e,t){return(a||=new WeakMap).get(e)||eW(e,t)}let e$=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch{return null}};function eJ(e,t){if(t&&"https:"!==e.protocol)throw em("only requests to HTTPS are allowed",tR,e);if("https:"!==e.protocol&&"http:"!==e.protocol)throw em("only HTTP and HTTPS requests are allowed",tO,e)}function eq(e,t,r,n){let a;if("string"!=typeof e||!(a=e$(e)))throw em(`authorization server metadata does not contain a valid ${r?`"as.mtls_endpoint_aliases.${t}"`:`"as.${t}"`}`,void 0===e?tH:tU,{attribute:r?`mtls_endpoint_aliases.${t}`:t});return eJ(a,n),a}function ez(e,t,r,n){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?eq(e.mtls_endpoint_aliases[t],t,r,n):eq(e[t],t,r,n)}async function eB(e,t,r,n,a){eK(e),eN(t);let i=ez(e,"pushed_authorization_request_endpoint",t.use_mtls_endpoint_aliases,a?.[ea]!==!0),s=new URLSearchParams(n);s.set("client_id",t.client_id);let o=eE(a?.headers);o.set("accept","application/json"),a?.DPoP!==void 0&&(e3(a.DPoP),await a.DPoP.addProof(i,o,"POST"));let c=await te(e,t,r,i,s,o,a);return a?.DPoP?.cacheNonce(c,i),c}class eF{#e;#t;#r;#n;#a;#i;#s;constructor(e,t,r){if(eb(t?.privateKey,'"DPoP.privateKey"'),!function(e,t){if(eg(e,t),"public"!==e.type)throw en(`${t} must be a public CryptoKey`,et)}(t?.publicKey,'"DPoP.publicKey"'),!t.publicKey.extractable)throw en('"DPoP.publicKey.extractable" must be true',et);this.#a=r?.[ec],this.#n=eD(e),this.#t=t.privateKey,this.#r=t.publicKey,td.add(this)}#o(e){this.#i||=new Map;let t=this.#i.get(e);return t&&(this.#i.delete(e),this.#i.set(e,t)),t}#c(e,t){this.#i||=new Map,this.#i.delete(e),100===this.#i.size&&this.#i.delete(this.#i.keys().next().value),this.#i.set(e,t)}async calculateThumbprint(){if(!this.#s){let e=await crypto.subtle.exportKey("jwk",this.#r);this.#s||=await ew(e)}return this.#s}async addProof(e,t,r,n){let a=eI(this.#t);this.#e||={alg:a,typ:"dpop+jwt",jwk:await eL(this.#r,a)};let i=this.#o(e.origin),s={iat:eU()+this.#n,jti:eO(),htm:r,nonce:i,htu:`${e.origin}${e.pathname}`,ath:n?ep(await crypto.subtle.digest("SHA-256",eh(n))):void 0};this.#a?.(this.#e,s),t.set("dpop",await ej(this.#e,s,this.#t))}cacheNonce(e,t){try{let r=e.headers.get("dpop-nonce");r&&this.#c(t.origin,r)}catch{}}}function eG(e){if(e instanceof eZ){let{0:t,length:r}=e.cause;return 1===r&&"dpop"===t.scheme&&"use_dpop_nonce"===t.parameters.error}return e instanceof eX&&"use_dpop_nonce"===e.error}function eV(e,t,r){return new eF(e,t,r)}class eX extends Error{cause;code;error;status;error_description;response;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=tA,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),Error.captureStackTrace?.(this,this.constructor)}}class eY extends Error{cause;code;error;error_description;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=t_,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=t.cause.get("error_description")??void 0,Error.captureStackTrace?.(this,this.constructor)}}class eZ extends Error{cause;code;response;status;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=tE,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),Error.captureStackTrace?.(this,this.constructor)}}let eQ="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",e0=RegExp("^[,\\s]*("+eQ+")"),e1=RegExp("^[,\\s]*("+eQ+')\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),e2=RegExp("^[,\\s]*"+("("+eQ+")\\s*=\\s*(")+eQ+")[,\\s]*(.*)"),e5=RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");async function e8(e,t,r){if(eK(e),eN(t),!ee(r,Response))throw en('"response" must be an instance of Response',er);await e4(r,201,"Pushed Authorization Request Endpoint"),tM(r);let n=await tV(r);eP(n.request_uri,'"response" body "request_uri" property',tT,{body:n});let a="number"!=typeof n.expires_in?parseFloat(n.expires_in):n.expires_in;return eT(a,!0,'"response" body "expires_in" property',tT,{body:n}),n.expires_in=a,n}async function e6(e){if(e.status>399&&e.status<500){tM(e),eR(e);try{let t=await e.clone().json();if(eS(t)&&"string"==typeof t.error&&t.error.length)return t}catch{}}}async function e4(e,t,r){if(e.status!==t){let t;if(to(e),t=await e6(e))throw await e.body?.cancel(),new eX("server responded with an error in the response body",{cause:t,response:e});throw em(`"response" is not a conform ${r} response (unexpected HTTP status code)`,tC,e)}}function e3(e){if(!td.has(e))throw en('"options.DPoP" is not a valid DPoPHandle',et)}async function e9(e,t,r,n,a,i){if(eP(e,'"accessToken"'),!(r instanceof URL))throw en('"url" must be an instance of URL',er);eJ(r,i?.[ea]!==!0),n=eE(n),i?.DPoP&&(e3(i.DPoP),await i.DPoP.addProof(r,n,t.toUpperCase(),e)),n.set("authorization",`${n.has("dpop")?"DPoP":"Bearer"} ${e}`);let s=await (i?.[eo]||fetch)(r.href,{body:a,headers:Object.fromEntries(n.entries()),method:t,redirect:"manual",signal:eA(r,i?.signal)});return i?.DPoP?.cacheNonce(s,r),s}async function e7(e,t,r,n,a,i){let s=await e9(e,t,r,n,a,i);return to(s),s}async function te(e,t,r,n,a,i,s){return await r(e,t,a,i),i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(s?.[eo]||fetch)(n.href,{body:a,headers:Object.fromEntries(i.entries()),method:"POST",redirect:"manual",signal:eA(n,s?.signal)})}async function tt(e,t,r,n,a,i){let s=ez(e,"token_endpoint",t.use_mtls_endpoint_aliases,i?.[ea]!==!0);a.set("grant_type",n);let o=eE(i?.headers);o.set("accept","application/json"),i?.DPoP!==void 0&&(e3(i.DPoP),await i.DPoP.addProof(s,o,"POST"));let c=await te(e,t,r,s,a,o,i);return i?.DPoP?.cacheNonce(c,s),c}async function tr(e,t,r,n,a){eK(e),eN(t),eP(n,'"refreshToken"');let i=new URLSearchParams(a?.additionalParameters);return i.set("refresh_token",n),tt(e,t,r,"refresh_token",i,a)}Symbol();let tn=new WeakMap,ta=new WeakMap;function ti(e){if(!e.id_token)return;let t=tn.get(e);if(!t)throw en('"ref" was already garbage collected or did not resolve from the proper sources',et);return t}async function ts(e,t,r,n,a,i){if(eK(e),eN(t),!ee(r,Response))throw en('"response" must be an instance of Response',er);await e4(r,200,"Token Endpoint"),tM(r);let s=await tV(r);if(eP(s.access_token,'"response" body "access_token" property',tT,{body:s}),eP(s.token_type,'"response" body "token_type" property',tT,{body:s}),s.token_type=s.token_type.toLowerCase(),void 0!==s.expires_in){let e="number"!=typeof s.expires_in?parseFloat(s.expires_in):s.expires_in;eT(e,!0,'"response" body "expires_in" property',tT,{body:s}),s.expires_in=e}if(void 0!==s.refresh_token&&eP(s.refresh_token,'"response" body "refresh_token" property',tT,{body:s}),void 0!==s.scope&&"string"!=typeof s.scope)throw em('"response" body "scope" property must be a string',tT,{body:s});if(void 0!==s.id_token){eP(s.id_token,'"response" body "id_token" property',tT,{body:s});let i=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&i.push("auth_time"),void 0!==t.default_max_age&&(eT(t.default_max_age,!0,'"client.default_max_age"'),i.push("auth_time")),n?.length&&i.push(...n);let{claims:o,jwt:c}=await tW(s.id_token,tL.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),eD(t),eH(t),a).then(ty.bind(void 0,i)).then(tl.bind(void 0,e)).then(tu.bind(void 0,t.client_id));if(Array.isArray(o.aud)&&1!==o.aud.length){if(void 0===o.azp)throw em('ID Token "aud" (audience) claim includes additional untrusted audiences',tI,{claims:o,claim:"aud"});if(o.azp!==t.client_id)throw em('unexpected ID Token "azp" (authorized party) claim value',tI,{expected:t.client_id,claims:o,claim:"azp"})}void 0!==o.auth_time&&eT(o.auth_time,!0,'ID Token "auth_time" (authentication time)',tT,{claims:o}),ta.set(r,c),tn.set(s,o)}if(i?.[s.token_type]!==void 0)i[s.token_type](r,s);else if("dpop"!==s.token_type&&"bearer"!==s.token_type)throw new ef("unsupported `token_type` value",{cause:{body:s}});return s}function to(e){let t;if(t=function(e){if(!ee(e,Response))throw en('"response" must be an instance of Response',er);let t=e.headers.get("www-authenticate");if(null===t)return;let r=[],n=t;for(;n;){let e,t=n.match(e0),a=t?.["1"].toLowerCase();if(!a)return;let i=n.substring(t[0].length);if(i&&!i.match(/^[\s,]/))return;let s=i.match(/^\s+(.*)$/),o=!!s;n=s?s[1]:void 0;let c={};if(o)for(;n;){let r,a;if(t=n.match(e1)){if([,r,a,n]=t,a.includes("\\"))try{a=JSON.parse(`"${a}"`)}catch{}c[r.toLowerCase()]=a;continue}if(t=n.match(e2)){[,r,a,n]=t,c[r.toLowerCase()]=a;continue}if(t=n.match(e5)){if(Object.keys(c).length)break;[,e,n]=t;break}return}else n=i||void 0;let u={scheme:a,parameters:c};e&&(u.token68=e),r.push(u)}if(r.length)return r}(e))throw new eZ("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:t,response:e})}async function tc(e,t,r,n){return ts(e,t,r,void 0,n?.[eu],n?.recognizedTokenTypes)}function tu(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw em('unexpected JWT "aud" (audience) claim value',tI,{expected:e,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==e)throw em('unexpected JWT "aud" (audience) claim value',tI,{expected:e,claims:t.claims,claim:"aud"});return t}function tl(e,t){let r=e[tY]?.(t)??e.issuer;if(t.claims.iss!==r)throw em('unexpected JWT "iss" (issuer) claim value',tI,{expected:r,claims:t.claims,claim:"iss"});return t}let td=new WeakSet,th=Symbol();async function tp(e,t,r,n,a,i,s){if(eK(e),eN(t),!td.has(n))throw en('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',et);eP(a,'"redirectUri"');let o=t$(n,"code");if(!o)throw em('no authorization code in "callbackParameters"',tT);let c=new URLSearchParams(s?.additionalParameters);return c.set("redirect_uri",a),c.set("code",o),i!==th&&(eP(i,'"codeVerifier"'),c.set("code_verifier",i)),tt(e,t,r,"authorization_code",c,s)}let tf={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function ty(e,t){for(let r of e)if(void 0===t.claims[r])throw em(`JWT "${r}" (${tf[r]}) claim missing`,tT,{claims:t.claims});return t}let tm=Symbol(),tw=Symbol();async function tg(e,t,r,n){return"string"==typeof n?.expectedNonce||"number"==typeof n?.maxAge||n?.requireIdToken?tb(e,t,r,n.expectedNonce,n.maxAge,n[eu],n.recognizedTokenTypes):tS(e,t,r,n?.[eu],n?.recognizedTokenTypes)}async function tb(e,t,r,n,a,i,s){let o=[];switch(n){case void 0:n=tm;break;case tm:break;default:eP(n,'"expectedNonce" argument'),o.push("nonce")}switch(a??=t.default_max_age){case void 0:a=tw;break;case tw:break;default:eT(a,!0,'"maxAge" argument'),o.push("auth_time")}let c=await ts(e,t,r,o,i,s);eP(c.id_token,'"response" body "id_token" property',tT,{body:c});let u=ti(c);if(a!==tw){let e=eU()+eD(t),r=eH(t);if(u.auth_time+a<e-r)throw em("too much time has elapsed since the last End-User authentication",tx,{claims:u,now:e,tolerance:r,claim:"auth_time"})}if(n===tm){if(void 0!==u.nonce)throw em('unexpected ID Token "nonce" claim value',tI,{expected:void 0,claims:u,claim:"nonce"})}else if(u.nonce!==n)throw em('unexpected ID Token "nonce" claim value',tI,{expected:n,claims:u,claim:"nonce"});return c}async function tS(e,t,r,n,a){let i=await ts(e,t,r,void 0,n,a),s=ti(i);if(s){if(void 0!==t.default_max_age){eT(t.default_max_age,!0,'"client.default_max_age"');let e=eU()+eD(t),r=eH(t);if(s.auth_time+t.default_max_age<e-r)throw em("too much time has elapsed since the last End-User authentication",tx,{claims:s,now:e,tolerance:r,claim:"auth_time"})}if(void 0!==s.nonce)throw em('unexpected ID Token "nonce" claim value',tI,{expected:void 0,claims:s,claim:"nonce"})}return i}let tE="OAUTH_WWW_AUTHENTICATE_CHALLENGE",tA="OAUTH_RESPONSE_BODY_ERROR",tk="OAUTH_UNSUPPORTED_OPERATION",t_="OAUTH_AUTHORIZATION_RESPONSE_ERROR",tv="OAUTH_PARSE_ERROR",tT="OAUTH_INVALID_RESPONSE",tP="OAUTH_RESPONSE_IS_NOT_JSON",tC="OAUTH_RESPONSE_IS_NOT_CONFORM",tR="OAUTH_HTTP_REQUEST_FORBIDDEN",tO="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",tx="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",tI="OAUTH_JWT_CLAIM_COMPARISON_FAILED",tD="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",tH="OAUTH_MISSING_SERVER_METADATA",tU="OAUTH_INVALID_SERVER_METADATA";async function tK(e,t,r,n,a,i){return eK(e),eN(t),eP(n,'"grantType"'),tt(e,t,r,n,new URLSearchParams(a),i)}async function tN(e,t,r,n){return ts(e,t,r,void 0,n?.[eu],n?.recognizedTokenTypes)}function tM(e){if(e.bodyUsed)throw en('"response" body has been used already',et)}function tj(e){let{algorithm:t}=e;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new ef(`unsupported ${t.name} modulusLength`,{cause:e})}async function tW(e,t,r,n,a){let i,s,{0:o,1:c,length:u}=e.split(".");if(5===u)if(void 0!==a)e=await a(e),{0:o,1:c,length:u}=e.split(".");else throw new ef("JWE decryption is not configured",{cause:e});if(3!==u)throw em("Invalid JWT",tT,e);try{i=JSON.parse(eh(ep(o)))}catch(e){throw em("failed to parse JWT Header body as base64url encoded JSON",tv,e)}if(!eS(i))throw em("JWT Header must be a top level object",tT,e);if(t(i),void 0!==i.crit)throw new ef('no JWT "crit" header parameter extensions are supported',{cause:{header:i}});try{s=JSON.parse(eh(ep(c)))}catch(e){throw em("failed to parse JWT Payload body as base64url encoded JSON",tv,e)}if(!eS(s))throw em("JWT Payload must be a top level object",tT,e);let l=eU()+r;if(void 0!==s.exp){if("number"!=typeof s.exp)throw em('unexpected JWT "exp" (expiration time) claim type',tT,{claims:s});if(s.exp<=l-n)throw em('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',tx,{claims:s,now:l,tolerance:n,claim:"exp"})}if(void 0!==s.iat&&"number"!=typeof s.iat)throw em('unexpected JWT "iat" (issued at) claim type',tT,{claims:s});if(void 0!==s.iss&&"string"!=typeof s.iss)throw em('unexpected JWT "iss" (issuer) claim type',tT,{claims:s});if(void 0!==s.nbf){if("number"!=typeof s.nbf)throw em('unexpected JWT "nbf" (not before) claim type',tT,{claims:s});if(s.nbf>l+n)throw em('unexpected JWT "nbf" (not before) claim value',tx,{claims:s,now:l,tolerance:n,claim:"nbf"})}if(void 0!==s.aud&&"string"!=typeof s.aud&&!Array.isArray(s.aud))throw em('unexpected JWT "aud" (audience) claim type',tT,{claims:s});return{header:i,claims:s,jwt:e}}function tL(e,t,r,n){if(void 0!==e){if("string"==typeof e?n.alg!==e:!e.includes(n.alg))throw em('unexpected JWT "alg" header parameter',tT,{header:n,expected:e,reason:"client configuration"});return}if(Array.isArray(t)){if(!t.includes(n.alg))throw em('unexpected JWT "alg" header parameter',tT,{header:n,expected:t,reason:"authorization server metadata"});return}if(void 0!==r){if("string"==typeof r?n.alg!==r:"function"==typeof r?!r(n.alg):!r.includes(n.alg))throw em('unexpected JWT "alg" header parameter',tT,{header:n,expected:r,reason:"default value"});return}throw em('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:e,issuer:t,fallback:r})}function t$(e,t){let{0:r,length:n}=e.getAll(t);if(n>1)throw em(`"${t}" parameter must be provided only once`,tT);return r}let tJ=Symbol(),tq=Symbol();async function tz(e,t,r,n,a){eK(e),eN(t);let i=ez(e,"backchannel_authentication_endpoint",t.use_mtls_endpoint_aliases,a?.[ea]!==!0),s=new URLSearchParams(n);s.set("client_id",t.client_id);let o=eE(a?.headers);return o.set("accept","application/json"),te(e,t,r,i,s,o,a)}async function tB(e,t,r){if(eK(e),eN(t),!ee(r,Response))throw en('"response" must be an instance of Response',er);await e4(r,200,"Backchannel Authentication Endpoint"),tM(r);let n=await tV(r);eP(n.auth_req_id,'"response" body "auth_req_id" property',tT,{body:n});let a="number"!=typeof n.expires_in?parseFloat(n.expires_in):n.expires_in;return eT(a,!0,'"response" body "expires_in" property',tT,{body:n}),n.expires_in=a,void 0!==n.interval&&eT(n.interval,!1,'"response" body "interval" property',tT,{body:n}),n}async function tF(e,t,r,n,a){eK(e),eN(t),eP(n,'"authReqId"');let i=new URLSearchParams(a?.additionalParameters);return i.set("auth_req_id",n),tt(e,t,r,"urn:openid:params:grant-type:ciba",i,a)}async function tG(e,t,r,n){return ts(e,t,r,void 0,n?.[eu],n?.recognizedTokenTypes)}async function tV(e,t=eR){let r;try{r=await e.json()}catch(r){throw t(e),em('failed to parse "response" body as JSON',tv,r)}if(!eS(r))throw em('"response" body must be a top level object',tT,{body:r});return r}let tX=Symbol(),tY=Symbol();function tZ(){return"string"==typeof globalThis.EdgeRuntime}let tQ=async e=>{let t=e?.delay??100,r=e?.jitter??!0,n=t;r&&(n=t*(.5+.5*Math.random())),await new Promise(e=>setTimeout(e,n))};async function t0(e,t){if(!t?.isDPoPEnabled)return await e();try{let r=await e();if(r instanceof Response&&400===r.status)try{let n=await r.clone().json();if("use_dpop_nonce"===n.error)return await tQ(t),await e()}catch{}return r}catch(r){if(eG(r))return await tQ(t),await e();throw r}}function t1(e,t){if(e){if("string"==typeof e)return e;if(!t)throw new j("When defining scope as a Map, an audience is required to look up the correct scope.");return e[t]}}function t2(e,t){return{accessToken:e.accessToken,expiresAt:e.expiresAt,audience:t.audience,scope:e.scope,requestedScope:e.requestedScope,...e.token_type&&{token_type:e.token_type}}}function t5(e){return e?e.trim().split(" ").filter(Boolean):[]}let t8=(e,t,r={})=>{if(e===t)return!0;if(!e||!t)return!1;let n=new Set(t5(e)),a=new Set(t5(t)),i=Array.from(a).every(e=>n.has(e));return r.strict?i&&n.size===a.size:i};function t6(e,t){return Array.from(new Set([...e?t5(e):[],...t?t5(t):[]])).join(" ")}function t4(e,t){let r=t.matchMode??"requestedScope",n=e?.accessTokens;if(!n||0===n.length)return;let a=n.filter(e=>e.audience===t.audience&&t8("scope"===r?e.scope:e.requestedScope??e.scope,t.scope,{strict:"scope"===r}));if(0!==a.length)return a.sort((e,t)=>{let r=new Set(t5(e.scope)),n=new Set(t5(t.scope));return r.size-n.size}),a[0]}function t3(e,t,r){if(r)return{accessTokens:r.accessTokens,tokenSet:{...e.tokenSet,idToken:t.idToken,refreshToken:t.refreshToken}}}function t9(e,t,r){let n,a,i=t1(r.scope,t.audience??r.audience);if(n=!t.audience||t.audience===(e.tokenSet.audience??r.audience),a=!t.requestedScope||t8(e.tokenSet.requestedScope??i,t.requestedScope),n&&a)return t.accessToken!==e.tokenSet.accessToken||t.expiresAt!==e.tokenSet.expiresAt||t.refreshToken!==e.tokenSet.refreshToken?{tokenSet:t}:void 0;let s=t.audience??r.audience,o=t.requestedScope??i??void 0;if(s)return function(e,t,r,n){var a;let i=t4(e,{scope:n,audience:r,matchMode:"requestedScope"});if(i){let n=function(e,t,r,n){if(t.accessToken!==r.accessToken)return{accessTokens:e.accessTokens?.map(e=>e===r?t2(t,{audience:n}):e)}}(e,t,i,r);return t3(e,t,n)}if(i=t4(e,{scope:t.scope,audience:r,matchMode:"scope"})){let n=(a=i,{accessTokens:e.accessTokens?.map(e=>e===a?t2({...t,requestedScope:t6(e.requestedScope,t.requestedScope),scope:t.scope},{audience:r}):e)});return t3(e,t,n)}{let n={accessTokens:[...e.accessTokens||[],t2(t,{audience:r})]};return t3(e,t,n)}}(e,t,s,o)}function t7(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let re=(e,...t)=>t7("Key must be ",e,...t),rt=(e,t,...r)=>t7(`Key for the ${e} algorithm must be `,t,...r),rr=new TextEncoder,rn=new TextDecoder;function ra(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}function ri(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function rs(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return ri(r,t,0),ri(r,e%0x100000000,4),r}function ro(e){let t=new Uint8Array(4);return ri(t,e),t}function rc(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);if(n>127)throw TypeError("non-ASCII string encountered in encode()");t[r]=n}return t}function ru(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}function rl(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:rn.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=rn.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return ru(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function rd(e){let t=e;return("string"==typeof t&&(t=rr.encode(t)),Uint8Array.prototype.toBase64)?t.toBase64({alphabet:"base64url",omitPadding:!0}):(function(e){if(Uint8Array.prototype.toBase64)return e.toBase64();let t=[];for(let r=0;r<e.length;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join(""))})(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function rh(e){if(!rp(e))throw Error("CryptoKey instance expected")}e.s(["decode",()=>rl,"encode",()=>rd],63370);let rp=e=>{if(e?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},rf=e=>e?.[Symbol.toStringTag]==="KeyObject",ry=e=>rp(e)||rf(e);async function rm(e){if(rf(e))if("secret"!==e.type)return e.export({format:"jwk"});else e=e.export();if(e instanceof Uint8Array)return{kty:"oct",k:rd(e)};if(!rp(e))throw TypeError(re(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:n,use:a,...i}=await crypto.subtle.exportKey("jwk",e);return"AKP"===i.kty&&(i.alg=n),i}async function rw(e){return rm(e)}async function rg(e,t){let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(r,t))}class rb extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class rS extends rb{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class rE extends rb{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class rA extends rb{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class rk extends rb{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class r_ extends rb{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(e="decryption operation failed",t){super(e,t)}}class rv extends rb{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class rT extends rb{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class rP extends rb{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class rC extends rb{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class rR extends rb{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class rO extends rb{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}class rx extends rb{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class rI extends rb{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(e="request timed out",t){super(e,t)}}class rD extends rb{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}function rH(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}let rU=e=>rH(e)&&"string"==typeof e.kty,rK=(e,t)=>{if("string"!=typeof e||!e)throw new rC(`${t} missing or invalid`)};async function rN(e,t){let r,n;if(rU(e))r=e;else if(ry(e))r=await rw(e);else throw TypeError(re(e,"CryptoKey","KeyObject","JSON Web Key"));if("sha256"!==(t??="sha256")&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(r.kty){case"AKP":rK(r.alg,'"alg" (Algorithm) Parameter'),rK(r.pub,'"pub" (Public key) Parameter'),n={alg:r.alg,kty:r.kty,pub:r.pub};break;case"EC":rK(r.crv,'"crv" (Curve) Parameter'),rK(r.x,'"x" (X Coordinate) Parameter'),rK(r.y,'"y" (Y Coordinate) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x,y:r.y};break;case"OKP":rK(r.crv,'"crv" (Subtype of Key Pair) Parameter'),rK(r.x,'"x" (Public Key) Parameter'),n={crv:r.crv,kty:r.kty,x:r.x};break;case"RSA":rK(r.e,'"e" (Exponent) Parameter'),rK(r.n,'"n" (Modulus) Parameter'),n={e:r.e,kty:r.kty,n:r.n};break;case"oct":rK(r.k,'"k" (Key Value) Parameter'),n={k:r.k,kty:r.kty};break;default:throw new rk('"kty" (Key Type) Parameter missing or unsupported')}let a=rc(JSON.stringify(n));return rd(await rg(t,a))}let rM=(e,t)=>{if(e.byteLength!==t.length)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0},rj=e=>{let t=e.data[e.pos++];if(128&t){let r=127&t,n=0;for(let t=0;t<r;t++)n=n<<8|e.data[e.pos++];return n}return t},rW=(e,t,r)=>{if(e.data[e.pos++]!==t)throw Error(r)},rL=(e,t)=>{let r=e.data.subarray(e.pos,e.pos+t);return e.pos+=t,r},r$=async(e,t,r,n)=>{let a,i,s="spki"===e,o=()=>s?["verify"]:["sign"];switch(r){case"PS256":case"PS384":case"PS512":a={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=o();break;case"RS256":case"RS384":case"RS512":a={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=o();break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":a={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=s?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":case"ES384":case"ES512":a={name:"ECDSA",namedCurve:({ES256:"P-256",ES384:"P-384",ES512:"P-521"})[r]},i=o();break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":try{let e=n.getNamedCurve(t);a="X25519"===e?{name:"X25519"}:{name:"ECDH",namedCurve:e}}catch(e){throw new rk("Invalid or unsupported key format")}i=s?[]:["deriveBits"];break;case"Ed25519":case"EdDSA":a={name:"Ed25519"},i=o();break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":a={name:r},i=o();break;default:throw new rk('Invalid or unsupported "alg" (Algorithm) value')}return crypto.subtle.importKey(e,t,a,n?.extractable??!!s,i)};async function rJ(e){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new rk('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new rk('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new rk('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new rk('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new rk('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),n={...e};return"AKP"!==n.kty&&delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,t,e.ext??(!e.d&&!e.priv),e.key_ops??r)}async function rq(e,t,r){let n,a,i;if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return n=/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,a=ru(e.replace(n,"")),i=r,t?.startsWith?.("ECDH-ES")&&((i||={}).getNamedCurve=e=>{let t,r={data:e,pos:0};return rW(r,48,"Invalid PKCS#8 structure"),rj(r),rW(r,2,"Expected version field"),t=rj(r),r.pos+=t,rW(r,48,"Expected algorithm identifier"),rj(r),r.pos,(e=>{let t,r=(rW(e,6,"Expected algorithm OID"),t=rj(e),rL(e,t));if(rM(r,[43,101,110]))return"X25519";if(!rM(r,[42,134,72,206,61,2,1]))throw Error("Unsupported key algorithm");rW(e,6,"Expected curve OID");let n=rj(e),a=rL(e,n);for(let{name:e,oid:t}of[{name:"P-256",oid:[42,134,72,206,61,3,1,7]},{name:"P-384",oid:[43,129,4,0,34]},{name:"P-521",oid:[43,129,4,0,35]}])if(rM(a,t))return e;throw Error("Unsupported named curve")})(r)}),r$("pkcs8",a,t,i)}async function rz(e,t,r){let n;if(!rH(e))throw TypeError("JWK must be an object");switch(t??=e.alg,n??=r?.extractable??e.ext,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return rl(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new rk('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return rJ({...e,alg:t,ext:n});case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==t&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return rJ({...e,ext:n});case"EC":case"OKP":return rJ({...e,alg:t,ext:n});default:throw new rk('Unsupported "kty" (Key Type) Parameter value')}}function rB(e){return rH(e)}class rF{#u;#l=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(rB)}(e))throw new rR("JSON Web Key Set malformed");this.#u=structuredClone(e)}jwks(){return this.#u}async getKey(e,t){let{alg:r,kid:n}={...e,...t?.header},a=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new rk('Unsupported "alg" value for a JSON Web Key Set')}}(r),i=this.#u.keys.filter(e=>{let t=a===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&("string"==typeof e.alg||"AKP"===a)&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":case"EdDSA":t="Ed25519"===e.crv}return t}),{0:s,length:o}=i;if(0===o)throw new rO;if(1!==o){let e=new rx,t=this.#l;throw e[Symbol.asyncIterator]=async function*(){for(let e of i)try{yield await rG(t,e,r)}catch{}},e}return rG(this.#l,s,r)}}async function rG(e,t,r){let n=e.get(t)||e.set(t,{}).get(t);if(void 0===n[r]){let e=await rz({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new rR("JSON Web Key Set members must be public keys");n[r]=e}return n[r]}function rV(e){let t=new rF(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),r}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(i="jose/v6.1.3");let rX=Symbol();async function rY(e,t,r,n=fetch){let a=await n(e,{method:"GET",signal:r,redirect:"manual",headers:t}).catch(e=>{if("TimeoutError"===e.name)throw new rI;throw e});if(200!==a.status)throw new rb("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await a.json()}catch{throw new rb("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let rZ=Symbol();class rQ{#d;#h;#p;#f;#y;#m;#w;#g;#b;#S;constructor(e,t){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");this.#d=new URL(e.href),this.#h="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this.#p="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this.#f="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,this.#w=new Headers(t?.headers),i&&!this.#w.has("User-Agent")&&this.#w.set("User-Agent",i),this.#w.has("accept")||(this.#w.set("accept","application/json"),this.#w.append("accept","application/jwk-set+json")),this.#g=t?.[rX],t?.[rZ]!==void 0&&(this.#S=t?.[rZ],function(e,t){return!("object"!=typeof e||null===e||!("uat"in e)||"number"!=typeof e.uat||Date.now()-e.uat>=t)&&"jwks"in e&&!!rH(e.jwks)&&!!Array.isArray(e.jwks.keys)&&!!Array.prototype.every.call(e.jwks.keys,rH)}(t?.[rZ],this.#f)&&(this.#y=this.#S.uat,this.#b=rV(this.#S.jwks)))}pendingFetch(){return!!this.#m}coolingDown(){return"number"==typeof this.#y&&Date.now()<this.#y+this.#p}fresh(){return"number"==typeof this.#y&&Date.now()<this.#y+this.#f}jwks(){return this.#b?.jwks()}async getKey(e,t){this.#b&&this.fresh()||await this.reload();try{return await this.#b(e,t)}catch(r){if(r instanceof rO&&!1===this.coolingDown())return await this.reload(),this.#b(e,t);throw r}}async reload(){this.#m&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#m=void 0),this.#m||=rY(this.#d.href,this.#w,AbortSignal.timeout(this.#h),this.#g).then(e=>{this.#b=rV(e),this.#S&&(this.#S.uat=Date.now(),this.#S.jwks=e),this.#y=Date.now(),this.#m=void 0}).catch(e=>{throw this.#m=void 0,e}),await this.#m}}function r0(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}let r1=(e,t="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`);function r2(e){return parseInt(e.name.slice(4),10)}function r5(e,t){if(t&&!e.usages.includes(t))throw TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)}function r8(e,t,r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if("AES-GCM"!==e.algorithm.name)throw r1("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw r1(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if("AES-KW"!==e.algorithm.name)throw r1("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw r1(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":break;default:throw r1("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if("PBKDF2"!==e.algorithm.name)throw r1("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if("RSA-OAEP"!==e.algorithm.name)throw r1("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(r2(e.algorithm.hash)!==r)throw r1(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}r5(e,r)}async function r6(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(re(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return!function(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if("HMAC"!==e.algorithm.name)throw r1("HMAC");let r=parseInt(t.slice(2),10);if(r2(e.algorithm.hash)!==r)throw r1(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if("RSASSA-PKCS1-v1_5"!==e.algorithm.name)throw r1("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(r2(e.algorithm.hash)!==r)throw r1(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if("RSA-PSS"!==e.algorithm.name)throw r1("RSA-PSS");let r=parseInt(t.slice(2),10);if(r2(e.algorithm.hash)!==r)throw r1(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if("Ed25519"!==e.algorithm.name)throw r1("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":let n;if(n=e.algorithm,n.name!==t)throw r1(t);break;case"ES256":case"ES384":case"ES512":{if("ECDSA"!==e.algorithm.name)throw r1("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw r1(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}r5(e,r)}(t,e,r),t}async function r4(e,t,r,n){let a=await r6(e,t,"verify");r0(e,a);let i=function(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new rk(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e,a.algorithm);try{return await crypto.subtle.verify(i,a,r,n)}catch{return!1}}function r3(...e){let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0}let r9=e=>e?.[Symbol.toStringTag],r7=(e,t,r)=>{if(void 0!==t.use){let e;switch(r){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError(`Invalid key for this operation, its "use" must be "${e}" when present`)}if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let n;switch(!0){case"sign"===r||"verify"===r:case"dir"===e:case e.includes("CBC-HS"):n=r;break;case e.startsWith("PBES2"):n="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):n=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===r?"wrapKey":"unwrapKey":r;break;case"encrypt"===r&&e.startsWith("RSA"):n="wrapKey";break;case"decrypt"===r:n=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(n&&t.key_ops?.includes?.(n)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${n}" when present`)}return!0};function ne(e,t,r){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((e,t,r)=>{if(!(t instanceof Uint8Array)){if(rU(t)){if("oct"===t.kty&&"string"==typeof t.k&&r7(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!ry(t))throw TypeError(rt(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==t.type)throw TypeError(`${r9(t)} instances for symmetric algorithms must be of type "secret"`)}})(e,t,r);break;default:((e,t,r)=>{if(rU(t))switch(r){case"decrypt":case"sign":if("oct"!==t.kty&&("AKP"===t.kty&&"string"==typeof t.priv||"string"==typeof t.d)&&r7(e,t,r))return;throw TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if("oct"!==t.kty&&void 0===t.d&&void 0===t.priv&&r7(e,t,r))return;throw TypeError("JSON Web Key for this operation must be a public JWK")}if(!ry(t))throw TypeError(rt(e,t,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===t.type)throw TypeError(`${r9(t)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===t.type)switch(r){case"sign":throw TypeError(`${r9(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${r9(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===t.type)switch(r){case"verify":throw TypeError(`${r9(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${r9(t)} instances for asymmetric algorithm encryption must be of type "public"`)}})(e,t,r)}}function nt(e,t,r,n,a){let i;if(void 0!==a.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,n.crit)){if(!i.has(s))throw new rk(`Extension Header Parameter "${s}" is not recognized`);if(void 0===a[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&void 0===n[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(n.crit)}function nr(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}let nn=async(e,t,r,n=!1)=>{let a=(s||=new WeakMap).get(e);if(a?.[r])return a[r];let i=await rJ({...t,alg:r});return n&&Object.freeze(e),a?a[r]=i:s.set(e,{[r]:i}),i};async function na(e,t){if(e instanceof Uint8Array||rp(e))return e;if(rf(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return((e,t)=>{let r,n=(s||=new WeakMap).get(e);if(n?.[t])return n[t];let a="public"===e.type,i=!!a;if("x25519"===e.asymmetricKeyType){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}r=e.toCryptoKey(e.asymmetricKeyType,i,a?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==t&&"Ed25519"!==t)throw TypeError("given KeyObject instance cannot be used for this algorithm");r=e.toCryptoKey(e.asymmetricKeyType,i,[a?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");r=e.toCryptoKey(e.asymmetricKeyType,i,[a?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let n;switch(t){case"RSA-OAEP":n="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":n="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":n="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":n="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:n},i,a?["encrypt"]:["decrypt"]);r=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:n},i,[a?"verify":"sign"])}if("ec"===e.asymmetricKeyType){let n=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!n)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===t&&"P-256"===n&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:n},i,[a?"verify":"sign"])),"ES384"===t&&"P-384"===n&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:n},i,[a?"verify":"sign"])),"ES512"===t&&"P-521"===n&&(r=e.toCryptoKey({name:"ECDSA",namedCurve:n},i,[a?"verify":"sign"])),t.startsWith("ECDH-ES")&&(r=e.toCryptoKey({name:"ECDH",namedCurve:n},i,a?[]:["deriveBits"]))}if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");return n?n[t]=r:s.set(e,{[t]:r}),r})(e,t)}catch(e){if(e instanceof TypeError)throw e}let r=e.export({format:"jwk"});return nn(e,r,t)}if(rU(e))return e.k?rl(e.k):nn(e,e,t,!0);throw Error("unreachable")}async function ni(e,t,r){let n,a;if(!rH(e))throw new rT("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new rT('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new rT("JWS Protected Header incorrect type");if(void 0===e.payload)throw new rT("JWS Payload missing");if("string"!=typeof e.signature)throw new rT("JWS Signature missing or incorrect type");if(void 0!==e.header&&!rH(e.header))throw new rT("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=rl(e.protected);i=JSON.parse(rn.decode(t))}catch{throw new rT("JWS Protected Header is invalid")}if(!r3(i,e.header))throw new rT("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...i,...e.header},o=nt(rT,new Map([["b64",!0]]),r?.crit,i,s),c=!0;if(o.has("b64")&&"boolean"!=typeof(c=i.b64))throw new rT('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:u}=s;if("string"!=typeof u||!u)throw new rT('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=r&&nr("algorithms",r.algorithms);if(l&&!l.has(u))throw new rA('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new rT("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new rT("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t&&(t=await t(i,e),d=!0),ne(u,t,"verify");let h=ra(void 0!==e.protected?rc(e.protected):new Uint8Array,rc("."),"string"==typeof e.payload?c?rc(e.payload):rr.encode(e.payload):e.payload);try{n=rl(e.signature)}catch{throw new rT("Failed to base64url decode the signature")}let p=await na(t,u);if(!await r4(u,p,n,h))throw new rD;if(c)try{a=rl(e.payload)}catch{throw new rT("Failed to base64url decode the payload")}else a="string"==typeof e.payload?rr.encode(e.payload):e.payload;let f={payload:a};return(void 0!==e.protected&&(f.protectedHeader=i),void 0!==e.header&&(f.unprotectedHeader=e.header),d)?{...f,key:p}:f}async function ns(e,t,r){if(e instanceof Uint8Array&&(e=rn.decode(e)),"string"!=typeof e)throw new rT("Compact JWS must be a string or Uint8Array");let{0:n,1:a,2:i,length:s}=e.split(".");if(3!==s)throw new rT("Invalid Compact JWS");let o=await ni({payload:a,protected:n,signature:i},t,r),c={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...c,key:o.key}:c}let no=e=>Math.floor(e.getTime()/1e3),nc=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function nu(e){let t,r=nc.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(0x1e187e0*n)}return"-"===r[1]||"ago"===r[4]?-t:t}function nl(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}let nd=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`;function nh(e,t,r={}){var n,a;let i,s;try{i=JSON.parse(rn.decode(t))}catch{}if(!rH(i))throw new rP("JWT Claims Set must be a top-level JSON object");let{typ:o}=r;if(o&&("string"!=typeof e.typ||nd(e.typ)!==nd(o)))throw new rS('unexpected "typ" JWT header value',i,"typ","check_failed");let{requiredClaims:c=[],issuer:u,subject:l,audience:d,maxTokenAge:h}=r,p=[...c];for(let e of(void 0!==h&&p.push("iat"),void 0!==d&&p.push("aud"),void 0!==l&&p.push("sub"),void 0!==u&&p.push("iss"),new Set(p.reverse())))if(!(e in i))throw new rS(`missing required "${e}" claim`,i,e,"missing");if(u&&!(Array.isArray(u)?u:[u]).includes(i.iss))throw new rS('unexpected "iss" claim value',i,"iss","check_failed");if(l&&i.sub!==l)throw new rS('unexpected "sub" claim value',i,"sub","check_failed");if(d&&(n=i.aud,a="string"==typeof d?[d]:d,"string"==typeof n?!a.includes(n):!(Array.isArray(n)&&a.some(Set.prototype.has.bind(new Set(n))))))throw new rS('unexpected "aud" claim value',i,"aud","check_failed");switch(typeof r.clockTolerance){case"string":s=nu(r.clockTolerance);break;case"number":s=r.clockTolerance;break;case"undefined":s=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:f}=r,y=no(f||new Date);if((void 0!==i.iat||h)&&"number"!=typeof i.iat)throw new rS('"iat" claim must be a number',i,"iat","invalid");if(void 0!==i.nbf){if("number"!=typeof i.nbf)throw new rS('"nbf" claim must be a number',i,"nbf","invalid");if(i.nbf>y+s)throw new rS('"nbf" claim timestamp check failed',i,"nbf","check_failed")}if(void 0!==i.exp){if("number"!=typeof i.exp)throw new rS('"exp" claim must be a number',i,"exp","invalid");if(i.exp<=y-s)throw new rE('"exp" claim timestamp check failed',i,"exp","check_failed")}if(h){let e=y-i.iat;if(e-s>("number"==typeof h?h:nu(h)))throw new rE('"iat" claim timestamp check failed (too far in the past)',i,"iat","check_failed");if(e<0-s)throw new rS('"iat" claim timestamp check failed (it should be in the past)',i,"iat","check_failed")}return i}class np{#E;constructor(e){if(!rH(e))throw TypeError("JWT Claims Set MUST be an object");this.#E=structuredClone(e)}data(){return rr.encode(JSON.stringify(this.#E))}get iss(){return this.#E.iss}set iss(e){this.#E.iss=e}get sub(){return this.#E.sub}set sub(e){this.#E.sub=e}get aud(){return this.#E.aud}set aud(e){this.#E.aud=e}set jti(e){this.#E.jti=e}set nbf(e){"number"==typeof e?this.#E.nbf=nl("setNotBefore",e):e instanceof Date?this.#E.nbf=nl("setNotBefore",no(e)):this.#E.nbf=no(new Date)+nu(e)}set exp(e){"number"==typeof e?this.#E.exp=nl("setExpirationTime",e):e instanceof Date?this.#E.exp=nl("setExpirationTime",no(e)):this.#E.exp=no(new Date)+nu(e)}set iat(e){void 0===e?this.#E.iat=no(new Date):e instanceof Date?this.#E.iat=nl("setIssuedAt",no(e)):"string"==typeof e?this.#E.iat=nl("setIssuedAt",no(new Date)+nu(e)):this.#E.iat=nl("setIssuedAt",e)}}async function nf(e,t,r){let n=await ns(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new rP("JWTs MUST NOT use unencoded payload");let a={payload:nh(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...a,key:n.key}:a}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(o={"user-agent":"openid-client/v6.8.1"});let ny="ERR_INVALID_ARG_VALUE",nm="ERR_INVALID_ARG_TYPE";function nw(e,t,r){let n=TypeError(e,{cause:r});return Object.assign(n,{code:t}),n}class ng extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=t?.code,Error.captureStackTrace?.(this,this.constructor)}}function nb(e,t,r){return new ng(e,{cause:t,code:r})}function nS(e){if(e instanceof TypeError||e instanceof ng||e instanceof eX||e instanceof eY||e instanceof eZ)throw e;if(e instanceof ey)switch(e.code){case tR:throw nb("only requests to HTTPS are allowed",e,e.code);case tO:throw nb("only requests to HTTP or HTTPS are allowed",e,e.code);case tC:throw nb("unexpected HTTP response status code",e.cause,e.code);case tP:throw nb("unexpected response content-type",e.cause,e.code);case tv:throw nb("parsing error occured",e,e.code);case tT:throw nb("invalid response encountered",e,e.code);case tI:throw nb("unexpected JWT claim value encountered",e,e.code);case tD:throw nb("unexpected JSON attribute value encountered",e,e.code);case tx:throw nb("JWT timestamp claim value failed validation",e,e.code);default:throw nb(e.message,e,e.code)}if(e instanceof ef)throw nb("unsupported operation",e,e.code);if(e instanceof DOMException)switch(e.name){case"OperationError":throw nb("runtime operation error",e,tk);case"NotSupportedError":throw nb("runtime unsupported operation",e,tk);case"TimeoutError":throw nb("operation timed out",e,"OAUTH_TIMEOUT");case"AbortError":throw nb("operation aborted",e,"OAUTH_ABORT")}throw new ng("something went wrong",{cause:e})}new TextDecoder;let nE=Symbol();class nA{constructor(e,t,r,n){let a;if("string"!=typeof t||!t.length)throw nw('"clientId" must be a non-empty string',nm);if("string"==typeof r&&(r={client_secret:r}),r?.client_id!==void 0&&t!==r.client_id)throw nw('"clientId" and "metadata.client_id" must be the same',ny);const i={...structuredClone(r),client_id:t};i[ei]=r?.[ei]??0,i[es]=r?.[es]??30,a=n||("string"==typeof i.client_secret&&i.client_secret.length?function(e){return void 0!==e?eM(e):(u||=new WeakMap,(e,t,r,n)=>{let a;return(a=u.get(t))||(function(e,t){if("string"!=typeof e)throw nw(`${t} must be a string`,nm);if(0===e.length)throw nw(`${t} must not be empty`,ny)}(t.client_secret,'"metadata.client_secret"'),a=eM(t.client_secret),u.set(t,a)),a(e,t,r,n)})}(i.client_secret):(e,t,r,n)=>{r.set("client_id",t.client_id)});let s=Object.freeze(i);const o=structuredClone(e);nE in e&&(o[tY]=({claims:{tid:t}})=>e.issuer.replace("{tenantid}",t));let l=Object.freeze(o);(c||=new WeakMap).set(this,{__proto__:null,as:l,c:s,auth:a,tlsOnly:!0,jwksCache:{}})}serverMetadata(){let e=structuredClone(c.get(this).as);return Object.defineProperties(e,{supportsPKCE:{__proto__:null,value:(t="S256")=>e.code_challenge_methods_supported?.includes(t)===!0}}),e}clientMetadata(){return structuredClone(c.get(this).c)}get timeout(){return c.get(this).timeout}set timeout(e){c.get(this).timeout=e}get[eo](){return c.get(this).fetch}set[eo](e){c.get(this).fetch=e}}async function nk(e,t,r,n=!1){let a,i=e.headers.get("retry-after")?.trim();if(void 0!==i){if(/^\d+$/.test(i))a=parseInt(i,10);else{let e=new Date(i);if(Number.isFinite(e.getTime())){let t=new Date,r=e.getTime()-t.getTime();r>0&&(a=Math.ceil(r/1e3))}}if(n&&!Number.isFinite(a))throw new ey("invalid Retry-After header value",{cause:e});a>t&&await n_(a-t,r)}}function n_(e,t){return new Promise((r,n)=>{let a=e=>{try{t.throwIfAborted()}catch(e){n(e);return}if(e<=0)return void r();let i=Math.min(e,5);setTimeout(()=>a(e-i),1e3*i)};a(e)})}async function nv(e,t){nP(e);let{as:r,c:n,auth:a,fetch:i,tlsOnly:s,timeout:u}=c.get(e);return tz(r,n,a,t,{[eo]:i,[ea]:!s,headers:new Headers(o),signal:nC(u)}).then(e=>tB(r,n,e)).catch(nS)}async function nT(e,t,r,n){var a,i,s;let u;nP(e),r=new URLSearchParams(r);let l=t.interval??5,d=n?.signal??AbortSignal.timeout(1e3*t.expires_in);try{await n_(l,d)}catch(e){nS(e)}let{as:h,c:p,auth:f,fetch:y,tlsOnly:m,nonRepudiation:w,timeout:g,decrypt:b}=c.get(e),S=(a,i)=>nT(e,{...t,interval:a},r,{...n,signal:d,flag:i}),E=await tF(h,p,f,t.auth_req_id,{[eo]:y,[ea]:!m,additionalParameters:r,DPoP:n?.DPoP,headers:new Headers(o),signal:d.aborted?d:nC(g)}).catch(nS);if(503===E.status&&E.headers.has("retry-after"))return await nk(E,l,d,!0),await E.body?.cancel(),S(l);let A=tG(h,p,E,{[eu]:b});try{u=await A}catch(e){if(i=e,s=n,s?.DPoP&&s.flag!==nR&&eG(i))return S(l,nR);if(e instanceof eX)switch(e.error){case"slow_down":l+=5;case"authorization_pending":return await nk(e.response,l,d),S(l)}nS(e)}return u.id_token&&await w?.(E),Object.defineProperties(a=u,function(e){let t;if(void 0!==e.expires_in){let r=new Date;r.setSeconds(r.getSeconds()+e.expires_in),t=r.getTime()}return{expiresIn:{__proto__:null,value(){if(t){let e=Date.now();return t>e?Math.floor((t-e)/1e3):0}}},claims:{__proto__:null,value(){try{return ti(this)}catch{return}}}}}(a)),u}function nP(e){if(!(e instanceof nA))throw nw('"config" must be an instance of Configuration',nm);if(Object.getPrototypeOf(e)!==nA.prototype)throw nw("subclassing Configuration is not allowed",ny)}function nC(e){return e?AbortSignal.timeout(1e3*e):void 0}Object.freeze(nA.prototype);let nR=Symbol();var nO=e.i(72418);function nx(e,t,r=[]){let n=new URLSearchParams,a={...e,...t};return Object.entries(a).forEach(([e,t])=>{r&&(r.includes(e)||null==t)||("scope"===e&&"object"==typeof t&&(t=t1(t,a.audience)),t&&n.set(e,String(t)))}),n}function nI(e){return e&&!e.endsWith("/")?`${e}/`:e}function nD(e){return e&&e.startsWith("/")?e.substring(1,e.length):e}(m=k||(k={})).SUBJECT_TYPE_REFRESH_TOKEN="urn:ietf:params:oauth:token-type:refresh_token",m.SUBJECT_TYPE_ACCESS_TOKEN="urn:ietf:params:oauth:token-type:access_token",(w=_||(_={})).CODE="code",w.CONNECT_CODE="connect_code";let nH=new Set(["accept","accept-language","content-language","content-type","user-agent","cache-control","if-match","if-none-match","if-modified-since","if-unmodified-since","etag","x-request-id","x-correlation-id","traceparent","tracestate","x-forwarded-for","x-forwarded-host","x-forwarded-proto","x-real-ip","origin","access-control-request-method","access-control-request-headers"]),nU=new Set(["connection","keep-alive","proxy-authenticate","proxy-authorization","te","trailer","transfer-encoding","upgrade"]);function nK(e){let t=new Headers;return e.headers.forEach((e,r)=>{let n=r.toLowerCase();nH.has(n)&&!nU.has(n)&&t.set(r,e)}),t}function nN(e){let t=new Headers;return e.headers.forEach((e,r)=>{let n=r.toLowerCase();nU.has(n)||t.set(r,e)}),t}function nM(e,t){let r=t.targetBaseUrl,n=e.nextUrl.pathname.startsWith(t.proxyPath)?e.nextUrl.pathname.slice(t.proxyPath.length):e.nextUrl.pathname;n&&!n.startsWith("/")&&(n="/"+n);let a=new URL(r.replace(/\/$/,"")),i=a.pathname,s=i;if(n&&"/"!==n){let e=i.split("/").filter(Boolean),t=n.split("/").filter(Boolean),r=0,a=Math.min(e.length,t.length);for(let n=a;n>=1;n--){let a=e.slice(-n),i=t.slice(0,n);if(a.every((e,t)=>e===i[t])){r=n;break}}let o=t.slice(r);if(o.length>0){let e="/"===i||i.endsWith("/")?"":"/";s=i+e+o.join("/")}}let o=new URL(a.origin+s);return e.nextUrl.searchParams.forEach((e,t)=>{o.searchParams.set(t,e)}),o}function nj(e,t){let r;try{r=new URL(e,t)}catch(e){return}if(r.origin===t.origin)return r}function nW(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),n=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?n:`${n}; ${r.join("; ")}`}function nL(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[n,a]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=a?a:"true"))}catch{}}return t}var n$=["strict","lax","none"],nJ=["low","medium","high"],nq=class{constructor(e){this._parsed=new Map,this._headers=e;const t=e.get("cookie");if(t)for(const[e,r]of nL(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>nW(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>nW(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},nz=class{constructor(e){var t,r,n;this._parsed=new Map,this._headers=e;const a=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[];for(const e of Array.isArray(a)?a:function(e){if(!e)return[];var t,r,n,a,i,s=[],o=0;function c(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,i=!1;c();)if(","===(r=e.charAt(o))){for(n=o,o+=1,c(),a=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(i=!0,o=a,s.push(e.substring(t,n)),t=o):o=n+1}else o+=1;(!i||o>=e.length)&&s.push(e.substring(t,e.length))}return s}(a)){const t=function(e){var t,r;if(!e)return;let[[n,a],...i]=nL(e),{domain:s,expires:o,httponly:c,maxage:u,path:l,samesite:d,secure:h,partitioned:p,priority:f}=Object.fromEntries(i.map(([e,t])=>[e.toLowerCase().replace(/-/g,""),t]));return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}({name:n,value:decodeURIComponent(a),domain:s,...o&&{expires:new Date(o)},...c&&{httpOnly:!0},..."string"==typeof u&&{maxAge:Number(u)},path:l,...d&&{sameSite:(t=(t=d).toLowerCase(),n$.includes(t)?t:void 0)},...h&&{secure:!0},...f&&{priority:(r=(r=f).toLowerCase(),nJ.includes(r)?r:void 0)},...p&&{partitioned:!0}})}(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){let[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,a=this._parsed;return a.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...n})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=nW(r);t.append("set-cookie",e)}}(a,this._headers),this}delete(...e){let[t,r]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0]];return this.set({...r,name:t,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(nW).join("; ")}};"function"!=typeof Q.hkdf||process.versions.electron||(l=async(...e)=>new Promise((t,r)=>{Q.hkdf(...e,(e,n)=>{e?r(e):t(new Uint8Array(n))})}));let nB=async(e,t,r,n,a)=>(l||((e,t,r,n,a)=>{let i=parseInt(e.substr(3),10)>>3||20,s=(0,Q.createHmac)(e,r.byteLength?r:new Uint8Array(i)).update(t).digest(),o=Math.ceil(a/i),c=new Uint8Array(i*o+n.byteLength+1),u=0,l=0;for(let t=1;t<=o;t++)c.set(n,l),c[l+n.byteLength]=t,c.set((0,Q.createHmac)(e,s).update(c.subarray(u,l+n.byteLength+1)).digest(),l),u=l,l+=i;return c.slice(0,a)}))(e,t,r,n,a);function nF(e,t){if("string"==typeof e)return new TextEncoder().encode(e);if(!(e instanceof Uint8Array))throw TypeError(`"${t}"" must be an instance of Uint8Array or a string`);return e}async function nG(e,t,r,n,a){return nB(function(e){switch(e){case"sha256":case"sha384":case"sha512":case"sha1":return e;default:throw TypeError('unsupported "digest" value')}}(e),function(e){let t=nF(e,"ikm");if(!t.byteLength)throw TypeError('"ikm" must be at least one byte in length');return t}(t),nF(r,"salt"),function(e){let t=nF(e,"info");if(t.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return t}(n),function(e,t){if("number"!=typeof e||!Number.isInteger(e)||e<1)throw TypeError('"keylen" must be a positive integer');if(e>255*(parseInt(t.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return e}(a,e))}let nV=Symbol();function nX(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new rk(`Unsupported JWE Algorithm: ${e}`)}}function nY(e,t){if(t.length<<3!==nX(e))throw new rv("Invalid Initialization Vector length")}function nZ(e,t){let r=e.byteLength<<3;if(r!==t)throw new rv(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)}async function nQ(e,t,r,n,a){if(!(r instanceof Uint8Array))throw TypeError(re(r,"Uint8Array"));let i=parseInt(e.slice(1,4),10),s=await crypto.subtle.importKey("raw",r.subarray(i>>3),"AES-CBC",!1,["encrypt"]),o=await crypto.subtle.importKey("raw",r.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),c=new Uint8Array(await crypto.subtle.encrypt({iv:n,name:"AES-CBC"},s,t)),u=ra(a,n,c,rs(a.length<<3));return{ciphertext:c,tag:new Uint8Array((await crypto.subtle.sign("HMAC",o,u)).slice(0,i>>3)),iv:n}}async function n0(e,t,r,n,a){let i;r instanceof Uint8Array?i=await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(r8(r,e,"encrypt"),i=r);let s=new Uint8Array(await crypto.subtle.encrypt({additionalData:a,iv:n,name:"AES-GCM",tagLength:128},i,t)),o=s.slice(-16);return{ciphertext:s.slice(0,-16),tag:o,iv:n}}async function n1(e,t,r,n,a){if(!rp(r)&&!(r instanceof Uint8Array))throw TypeError(re(r,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(n)nY(e,n);else n=crypto.getRandomValues(new Uint8Array(nX(e)>>3));switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&nZ(r,parseInt(e.slice(-3),10)),nQ(e,t,r,n,a);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&nZ(r,parseInt(e.slice(1,4),10)),n0(e,t,r,n,a);default:throw new rk("Unsupported JWE Content Encryption Algorithm")}}function n2(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function n5(e,t,r){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"AES-KW",!0,[r]):(r8(e,t,r),e)}async function n8(e,t,r){let n=await n5(t,e,"wrapKey");n2(n,e);let a=await crypto.subtle.importKey("raw",r,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",a,n,"AES-KW"))}async function n6(e,t,r){let n=await n5(t,e,"unwrapKey");n2(n,e);let a=await crypto.subtle.unwrapKey("raw",r,n,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",a))}function n4(e){return ra(ro(e.length),e)}async function n3(e,t,r){let n=t>>3,a=Math.ceil(n/32),i=new Uint8Array(32*a);for(let t=1;t<=a;t++){let n=new Uint8Array(4+e.length+r.length);n.set(ro(t),0),n.set(e,4),n.set(r,4+e.length);let a=await rg("sha256",n);i.set(a,(t-1)*32)}return i.slice(0,n)}async function n9(e,t,r,n,a=new Uint8Array,i=new Uint8Array){var s;r8(e,"ECDH"),r8(t,"ECDH","deriveBits");let o=ra(n4(rc(r)),n4(a),n4(i),ro(n),new Uint8Array);return n3(new Uint8Array(await crypto.subtle.deriveBits({name:e.algorithm.name,public:e},t,"X25519"===(s=e).algorithm.name?256:Math.ceil(parseInt(s.algorithm.namedCurve.slice(-3),10)/8)<<3)),n,o)}function n7(e){switch(e.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===e.algorithm.name}}async function ae(e,t,r,n){if(!(e instanceof Uint8Array)||e.length<8)throw new rv("PBES2 Salt Input must be 8 or more octets");let a=ra(rc(t),Uint8Array.of(0),e),i=parseInt(t.slice(13,16),10),s={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:a},o=await (n instanceof Uint8Array?crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits"]):(r8(n,t,"deriveBits"),n));return new Uint8Array(await crypto.subtle.deriveBits(s,o,i))}async function at(e,t,r,n=2048,a=crypto.getRandomValues(new Uint8Array(16))){let i=await ae(a,e,n,t);return{encryptedKey:await n8(e.slice(-6),i,r),p2c:n,p2s:rd(a)}}async function ar(e,t,r,n,a){let i=await ae(a,e,n,t);return n6(e.slice(-6),i,r)}let an=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new rk(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};async function aa(e,t,r){return r8(t,e,"encrypt"),r0(e,t),new Uint8Array(await crypto.subtle.encrypt(an(e),t,r))}async function ai(e,t,r){return r8(t,e,"decrypt"),r0(e,t),new Uint8Array(await crypto.subtle.decrypt(an(e),t,r))}function as(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new rk(`Unsupported JWE Algorithm: ${e}`)}}let ao=e=>crypto.getRandomValues(new Uint8Array(as(e)>>3));async function ac(e,t){if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let r={name:"HMAC",hash:"SHA-256"},n=await crypto.subtle.generateKey(r,!1,["sign"]),a=new Uint8Array(await crypto.subtle.sign(r,n,e)),i=new Uint8Array(await crypto.subtle.sign(r,n,t)),s=0,o=-1;for(;++o<32;)s|=a[o]^i[o];return 0===s}async function au(e,t,r,n,a,i){let s,o;if(!(t instanceof Uint8Array))throw TypeError(re(t,"Uint8Array"));let c=parseInt(e.slice(1,4),10),u=await crypto.subtle.importKey("raw",t.subarray(c>>3),"AES-CBC",!1,["decrypt"]),l=await crypto.subtle.importKey("raw",t.subarray(0,c>>3),{hash:`SHA-${c<<1}`,name:"HMAC"},!1,["sign"]),d=ra(i,n,r,rs(i.length<<3)),h=new Uint8Array((await crypto.subtle.sign("HMAC",l,d)).slice(0,c>>3));try{s=await ac(a,h)}catch{}if(!s)throw new r_;try{o=new Uint8Array(await crypto.subtle.decrypt({iv:n,name:"AES-CBC"},u,r))}catch{}if(!o)throw new r_;return o}async function al(e,t,r,n,a,i){let s;t instanceof Uint8Array?s=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(r8(t,e,"decrypt"),s=t);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:i,iv:n,name:"AES-GCM",tagLength:128},s,ra(r,a)))}catch{throw new r_}}async function ad(e,t,r,n,a,i){if(!rp(t)&&!(t instanceof Uint8Array))throw TypeError(re(t,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!n)throw new rv("JWE Initialization Vector missing");if(!a)throw new rv("JWE Authentication Tag missing");switch(nY(e,n),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&nZ(t,parseInt(e.slice(-3),10)),au(e,t,r,n,a,i);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&nZ(t,parseInt(e.slice(1,4),10)),al(e,t,r,n,a,i);default:throw new rk("Unsupported JWE Content Encryption Algorithm")}}async function ah(e,t,r,n){let a=e.slice(0,7),i=await n1(a,r,t,n,new Uint8Array);return{encryptedKey:i.ciphertext,iv:rd(i.iv),tag:rd(i.tag)}}async function ap(e,t,r,n,a){return ad(e.slice(0,7),t,r,n,a,new Uint8Array)}async function af(e,t,r,n,a={}){let i,s,o;switch(e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let c;if(rh(r),!n7(r))throw new rk("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:u,apv:l}=a;c=a.epk?await na(a.epk,e):(await crypto.subtle.generateKey(r.algorithm,!0,["deriveBits"])).privateKey;let{x:d,y:h,crv:p,kty:f}=await rw(c),y=await n9(r,c,"ECDH-ES"===e?t:e,"ECDH-ES"===e?as(t):parseInt(e.slice(-5,-2),10),u,l);if(s={epk:{x:d,crv:p,kty:f}},"EC"===f&&(s.epk.y=h),u&&(s.apu=rd(u)),l&&(s.apv=rd(l)),"ECDH-ES"===e){o=y;break}o=n||ao(t);let m=e.slice(-6);i=await n8(m,y,o);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=n||ao(t),rh(r),i=await aa(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=n||ao(t);let{p2c:c,p2s:u}=a;({encryptedKey:i,...s}=await at(e,r,o,c,u));break}case"A128KW":case"A192KW":case"A256KW":o=n||ao(t),i=await n8(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=n||ao(t);let{iv:c}=a;({encryptedKey:i,...s}=await ah(e,r,o,c));break}default:throw new rk('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:i,parameters:s}}class ay{#A;#k;#_;#v;#T;#P;#C;#R;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#A=e}setKeyManagementParameters(e){if(this.#R)throw TypeError("setKeyManagementParameters can only be called once");return this.#R=e,this}setProtectedHeader(e){if(this.#k)throw TypeError("setProtectedHeader can only be called once");return this.#k=e,this}setSharedUnprotectedHeader(e){if(this.#_)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#_=e,this}setUnprotectedHeader(e){if(this.#v)throw TypeError("setUnprotectedHeader can only be called once");return this.#v=e,this}setAdditionalAuthenticatedData(e){return this.#T=e,this}setContentEncryptionKey(e){if(this.#P)throw TypeError("setContentEncryptionKey can only be called once");return this.#P=e,this}setInitializationVector(e){if(this.#C)throw TypeError("setInitializationVector can only be called once");return this.#C=e,this}async encrypt(e,t){let r,n,a,i,s,o;if(!this.#k&&!this.#v&&!this.#_)throw new rv("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!r3(this.#k,this.#v,this.#_))throw new rv("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this.#k,...this.#v,...this.#_};if(nt(rv,new Map,t?.crit,this.#k,c),void 0!==c.zip)throw new rk('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:u,enc:l}=c;if("string"!=typeof u||!u)throw new rv('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof l||!l)throw new rv('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#P&&("dir"===u||"ECDH-ES"===u))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${u}`);ne("dir"===u?l:u,e,"encrypt");{let a,i=await na(e,u);({cek:n,encryptedKey:r,parameters:a}=await af(u,l,i,this.#P,this.#R)),a&&(t&&nV in t?this.#v?this.#v={...this.#v,...a}:this.setUnprotectedHeader(a):this.#k?this.#k={...this.#k,...a}:this.setProtectedHeader(a))}if(this.#k?s=rc(i=rd(JSON.stringify(this.#k))):(i="",s=new Uint8Array),this.#T){let e=rc(o=rd(this.#T));a=ra(s,rc("."),e)}else a=s;let{ciphertext:d,tag:h,iv:p}=await n1(l,this.#A,n,this.#C,a),f={ciphertext:rd(d)};return p&&(f.iv=rd(p)),h&&(f.tag=rd(h)),r&&(f.encrypted_key=rd(r)),o&&(f.aad=o),this.#k&&(f.protected=i),this.#_&&(f.unprotected=this.#_),this.#v&&(f.header=this.#v),f}}class am{#O;constructor(e){this.#O=new ay(e)}setContentEncryptionKey(e){return this.#O.setContentEncryptionKey(e),this}setInitializationVector(e){return this.#O.setInitializationVector(e),this}setProtectedHeader(e){return this.#O.setProtectedHeader(e),this}setKeyManagementParameters(e){return this.#O.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this.#O.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}class aw{#P;#C;#R;#k;#x;#I;#D;#H;constructor(e={}){this.#H=new np(e)}setIssuer(e){return this.#H.iss=e,this}setSubject(e){return this.#H.sub=e,this}setAudience(e){return this.#H.aud=e,this}setJti(e){return this.#H.jti=e,this}setNotBefore(e){return this.#H.nbf=e,this}setExpirationTime(e){return this.#H.exp=e,this}setIssuedAt(e){return this.#H.iat=e,this}setProtectedHeader(e){if(this.#k)throw TypeError("setProtectedHeader can only be called once");return this.#k=e,this}setKeyManagementParameters(e){if(this.#R)throw TypeError("setKeyManagementParameters can only be called once");return this.#R=e,this}setContentEncryptionKey(e){if(this.#P)throw TypeError("setContentEncryptionKey can only be called once");return this.#P=e,this}setInitializationVector(e){if(this.#C)throw TypeError("setInitializationVector can only be called once");return this.#C=e,this}replicateIssuerAsHeader(){return this.#x=!0,this}replicateSubjectAsHeader(){return this.#I=!0,this}replicateAudienceAsHeader(){return this.#D=!0,this}async encrypt(e,t){let r=new am(this.#H.data());return this.#k&&(this.#x||this.#I||this.#D)&&(this.#k={...this.#k,iss:this.#x?this.#H.iss:void 0,sub:this.#I?this.#H.sub:void 0,aud:this.#D?this.#H.aud:void 0}),r.setProtectedHeader(this.#k),this.#C&&r.setInitializationVector(this.#C),this.#P&&r.setContentEncryptionKey(this.#P),this.#R&&r.setKeyManagementParameters(this.#R),r.encrypt(e,t)}}async function ag(e,t,r,n,a){switch(e){case"dir":if(void 0!==r)throw new rv("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new rv("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let a,i;if(!rH(n.epk))throw new rv('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(rh(t),!n7(t))throw new rk("ECDH with the provided key is not allowed or not supported by your javascript runtime");let s=await rz(n.epk,e);if(rh(s),void 0!==n.apu){if("string"!=typeof n.apu)throw new rv('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{a=rl(n.apu)}catch{throw new rv("Failed to base64url decode the apu")}}if(void 0!==n.apv){if("string"!=typeof n.apv)throw new rv('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{i=rl(n.apv)}catch{throw new rv("Failed to base64url decode the apv")}}let o=await n9(s,t,"ECDH-ES"===e?n.enc:e,"ECDH-ES"===e?as(n.enc):parseInt(e.slice(-5,-2),10),a,i);if("ECDH-ES"===e)return o;if(void 0===r)throw new rv("JWE Encrypted Key missing");return n6(e.slice(-6),o,r)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new rv("JWE Encrypted Key missing");return rh(t),ai(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let i;if(void 0===r)throw new rv("JWE Encrypted Key missing");if("number"!=typeof n.p2c)throw new rv('JOSE Header "p2c" (PBES2 Count) missing or invalid');let s=a?.maxPBES2Count||1e4;if(n.p2c>s)throw new rv('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof n.p2s)throw new rv('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{i=rl(n.p2s)}catch{throw new rv("Failed to base64url decode the p2s")}return ar(e,t,r,n.p2c,i)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new rv("JWE Encrypted Key missing");return n6(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let a,i;if(void 0===r)throw new rv("JWE Encrypted Key missing");if("string"!=typeof n.iv)throw new rv('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof n.tag)throw new rv('JOSE Header "tag" (Authentication Tag) missing or invalid');try{a=rl(n.iv)}catch{throw new rv("Failed to base64url decode the iv")}try{i=rl(n.tag)}catch{throw new rv("Failed to base64url decode the tag")}return ap(e,t,r,a,i)}default:throw new rk('Invalid or unsupported "alg" (JWE Algorithm) header value')}}async function ab(e,t,r){let n,a,i,s,o,c,u;if(!rH(e))throw new rv("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new rv("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new rv("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new rv("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new rv("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new rv("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new rv("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new rv("JWE AAD incorrect type");if(void 0!==e.header&&!rH(e.header))throw new rv("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!rH(e.unprotected))throw new rv("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=rl(e.protected);n=JSON.parse(rn.decode(t))}catch{throw new rv("JWE Protected Header is invalid")}if(!r3(n,e.header,e.unprotected))throw new rv("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let l={...n,...e.header,...e.unprotected};if(nt(rv,new Map,r?.crit,n,l),void 0!==l.zip)throw new rk('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:d,enc:h}=l;if("string"!=typeof d||!d)throw new rv("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof h||!h)throw new rv("missing JWE Encryption Algorithm (enc) in JWE Header");let p=r&&nr("keyManagementAlgorithms",r.keyManagementAlgorithms),f=r&&nr("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(p&&!p.has(d)||!p&&d.startsWith("PBES2"))throw new rA('"alg" (Algorithm) Header Parameter value not allowed');if(f&&!f.has(h))throw new rA('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{a=rl(e.encrypted_key)}catch{throw new rv("Failed to base64url decode the encrypted_key")}let y=!1;"function"==typeof t&&(t=await t(n,e),y=!0),ne("dir"===d?h:d,t,"decrypt");let m=await na(t,d);try{i=await ag(d,m,a,l,r)}catch(e){if(e instanceof TypeError||e instanceof rv||e instanceof rk)throw e;i=ao(h)}if(void 0!==e.iv)try{s=rl(e.iv)}catch{throw new rv("Failed to base64url decode the iv")}if(void 0!==e.tag)try{o=rl(e.tag)}catch{throw new rv("Failed to base64url decode the tag")}let w=void 0!==e.protected?rc(e.protected):new Uint8Array;c=void 0!==e.aad?ra(w,rc("."),rc(e.aad)):w;try{u=rl(e.ciphertext)}catch{throw new rv("Failed to base64url decode the ciphertext")}let g={plaintext:await ad(h,i,u,s,o,c)};if(void 0!==e.protected&&(g.protectedHeader=n),void 0!==e.aad)try{g.additionalAuthenticatedData=rl(e.aad)}catch{throw new rv("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(g.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(g.unprotectedHeader=e.header),y)?{...g,key:m}:g}async function aS(e,t,r){if(e instanceof Uint8Array&&(e=rn.decode(e)),"string"!=typeof e)throw new rv("Compact JWE must be a string or Uint8Array");let{0:n,1:a,2:i,3:s,4:o,length:c}=e.split(".");if(5!==c)throw new rv("Invalid Compact JWE");let u=await ab({ciphertext:s,iv:i||void 0,protected:n,tag:o||void 0,encrypted_key:a||void 0},t,r),l={plaintext:u.plaintext,protectedHeader:u.protectedHeader};return"function"==typeof t?{...l,key:u.key}:l}async function aE(e,t,r){let n=await aS(e,t,r),a=nh(n.protectedHeader,n.plaintext,r),{protectedHeader:i}=n;if(void 0!==i.iss&&i.iss!==a.iss)throw new rS('replicated "iss" claim header parameter mismatch',a,"iss","mismatch");if(void 0!==i.sub&&i.sub!==a.sub)throw new rS('replicated "sub" claim header parameter mismatch',a,"sub","mismatch");if(void 0!==i.aud&&JSON.stringify(i.aud)!==JSON.stringify(a.aud))throw new rS('replicated "aud" claim header parameter mismatch',a,"aud","mismatch");let s={payload:a,protectedHeader:i};return"function"==typeof t?{...s,key:n.key}:s}var aA=e.i(63370),aA=aA;let ak="sha256",a_="JWE CEK";async function av(e,t,r,n){let a=await nG(ak,t,"",a_,32);return(await new aw(e).setProtectedHeader({enc:"A256GCM",alg:"dir",...n}).setExpirationTime(r).encrypt(a)).toString()}async function aT(e,t,r){try{let n=await nG(ak,t,"",a_,32);return await aE(e,n,{...r,clockTolerance:15})}catch(e){if("ERR_JWT_EXPIRED"===e.code)return null;throw e}}async function aP(e,t,r){if(!t)return;let[n,a]=t.split("."),i={protected:aA.encode(JSON.stringify({alg:"HS256",b64:!1,crit:["b64"]})),payload:`${e}=${n}`,signature:a},s=await nG("sha256",r,"","JWS Cookie Signing",32);try{return await ni(i,s,{algorithms:["HS256"]}),n}catch(e){return}}let aC=RegExp("__(\\d+)$"),aR=/\.(\d+)$/,aO=(e,t)=>{let r=t?aR.exec(e):aC.exec(e);if(r)return parseInt(r[1],10)},ax=(e,t,r)=>{let n=new RegExp(r?`^${t}${aR.source}$`:`^${t}__\\d+$`);return e.getAll().filter(e=>n.test(e.name))};function aI(e,t,r){let n=t.get(e);if(n?.value)return n.value;let a=ax(t,e,r).sort((e,t)=>aO(e.name,r)-aO(t.name,r));if(0===a.length)return;let i=aO(a[a.length-1].name,r);return a.length!==i+1?void console.warn(`Incomplete chunked cookie '${e}': Found ${a.length} chunks, expected ${i+1}`):a.map(e=>e.value).join("")}function aD(e,t,r,n,a){aU(r,e,a),ax(t,e,n).forEach(e=>{aU(r,e.name,a)})}function aH(e){e.headers.set("Cache-Control","private, no-cache, no-store, must-revalidate, max-age=0"),e.headers.set("Pragma","no-cache"),e.headers.set("Expires","0")}function aU(e,t,r){let n={maxAge:0};r?.domain&&(n.domain=r.domain),r?.path&&(n.path=r.path),e.set(t,"",n)}class aK{constructor(e,t){this.hooks=t,this.config={...e,fetch:e.fetch||fetch}}isAbsoluteUrl(e){try{return new URL(e),!0}catch{return!1}}buildUrl(e,t){if(t){if(this.isAbsoluteUrl(t))return t;if(e)return`${e.replace(/\/?\/$/,"")}/${t.replace(/^\/+/,"")}`}throw TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(e){return this.config.getAccessToken?this.config.getAccessToken(e??{}):this.hooks.getAccessToken(e??{})}buildBaseRequest(e,t){let r;return r=e instanceof Request?e.url:e instanceof URL?e.toString():this.config.baseUrl&&!this.isAbsoluteUrl(e)?this.buildUrl(this.config.baseUrl,e):e,new Request(r,t)}getHeader(e,t){return Array.isArray(e)?new Headers(e).get(t)||"":"function"==typeof e.get?e.get(t)||"":e[t]||""}async internalFetchWithAuth(e,t,r,n){let a,i,s=this.buildBaseRequest(e,t),o=await this.getAccessToken(n);"string"==typeof o?(a=!!this.config.dpopHandle,i=o):(a=!!this.config.dpopHandle&&o.token_type?.toLowerCase()==="dpop",i=o.accessToken);try{return await e7(i,s.method,new URL(s.url),s.headers,s.body,{...this.config.httpOptions(),[eo]:(e,t)=>this.config.fetch(e,t),[ea]:this.config.allowInsecureRequests||!1,...a&&{DPoP:this.config.dpopHandle}})}catch(e){if(eG(e)&&r.onUseDpopNonceError)return r.onUseDpopNonceError();throw e}}isRequestInit(e){return!!e&&"object"==typeof e&&!["refresh","scope","audience"].some(t=>Object.prototype.hasOwnProperty.call(e,t))}fetchWithAuth(e,t,r){let n,a;2==arguments.length&&void 0!==t?this.isRequestInit(t)?(n=t,a=void 0):(n=void 0,a=t):(n=t,a=r);let i={onUseDpopNonceError:async()=>{let t=this.config.retryConfig??{delay:100,jitter:!0},r=t.delay??100;t.jitter&&(r*=.5+.5*Math.random()),await new Promise(e=>setTimeout(e,r));try{return await this.internalFetchWithAuth(e,n,{...i,onUseDpopNonceError:void 0},a)}catch(e){if(eG(e)){let t=Error(`DPoP nonce error persisted after retry: ${e.message}`);throw t.code=e.code||"dpop_nonce_retry_failed",t}throw e}}};return this.internalFetchWithAuth(e,n,i,a)}}let aN=["sub","name","nickname","given_name","family_name","picture","email","email_verified","org_id"];var aM=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};let aj=["client_id","redirect_uri","response_type","code_challenge","code_challenge_method","state","nonce"];function aW(e,t){return new URL(nD((e=>{let t=process.env.NEXT_PUBLIC_BASE_PATH;return t?nI(t&&!t.startsWith("/")?`/${t}`:t)+nD(e):e})(e)),nI(t))}class aL{constructor(e){v.add(this),this.proxyFetchers={},this.fetch=e.fetch||fetch,this.jwksCache=e.jwksCache||{},this.allowInsecureRequests=e.allowInsecureRequests??!1,this.httpTimeout=e.httpTimeout??5e3,this.httpOptions=()=>{let t=new Headers;if(e.enableTelemetry??!0){let e="nextjs-auth0",r=nO.default.version;t.set("User-Agent",`${e}/${r}`),t.set("Auth0-Client",a$(JSON.stringify({name:e,version:r})))}return{signal:AbortSignal.timeout(this.httpTimeout),headers:t}},this.allowInsecureRequests&&console.warn("allowInsecureRequests is enabled in a production environment. This is not recommended."),this.transactionStore=e.transactionStore,this.sessionStore=e.sessionStore,this.domain=e.domain,this.clientMetadata={client_id:e.clientId},e.dpopOptions&&("number"==typeof e.dpopOptions.clockSkew&&(this.clientMetadata[ei]=e.dpopOptions.clockSkew),"number"==typeof e.dpopOptions.clockTolerance&&(this.clientMetadata[es]=e.dpopOptions.clockTolerance)),this.dpopOptions=e.dpopOptions,this.clientSecret=e.clientSecret,this.authorizationParameters=e.authorizationParameters||{scope:Z},this.pushedAuthorizationRequests=e.pushedAuthorizationRequests??!1,this.clientAssertionSigningKey=e.clientAssertionSigningKey,this.clientAssertionSigningAlg=e.clientAssertionSigningAlg||"RS256",this.authorizationParameters.scope=function(e){if(!e.scope)return Z;if("object"==typeof e.scope&&!t1(e.scope,e.audience)){let t=e.audience;return{...e.scope,[t]:Z}}return e.scope}(this.authorizationParameters);const t=t1(this.authorizationParameters.scope,this.authorizationParameters.audience)?.split(" ").map(e=>e.trim());if(!t||!t.includes("openid"))throw Error("The 'openid' scope must be included in the set of scopes. See https://auth0.com/docs");this.appBaseUrl=e.appBaseUrl,this.signInReturnToPath=e.signInReturnToPath||"/";const r=["auto","oidc","v2"];let n=e.logoutStrategy||"auto";r.includes(n)||(console.error(`Invalid logoutStrategy: ${n}. Must be one of: ${r.join(", ")}. Defaulting to "auto"`),n="auto"),this.logoutStrategy=n,this.includeIdTokenHintInOIDCLogoutUrl=e.includeIdTokenHintInOIDCLogoutUrl??!0,this.beforeSessionSaved=e.beforeSessionSaved,this.onCallback=e.onCallback||this.defaultOnCallback,this.routes=e.routes,this.enableAccessTokenEndpoint=e.enableAccessTokenEndpoint??!0,this.noContentProfileResponseWhenUnauthenticated=e.noContentProfileResponseWhenUnauthenticated??!1,this.enableConnectAccountEndpoint=e.enableConnectAccountEndpoint??!1,this.useDPoP=e.useDPoP??!1,e.useDPoP&&e.dpopKeyPair&&(this.dpopKeyPair=e.dpopKeyPair)}async handler(e){let t,{pathname:r}=e.nextUrl,n=e.nextUrl.basePath;n&&r.startsWith(n)&&(r=r.slice(n.length)||"/");let a=(t=r).endsWith("/")?t.slice(0,-1):t,i=e.method;if("GET"===i&&a===this.routes.login)return this.handleLogin(e);{if("GET"===i&&a===this.routes.logout)return this.handleLogout(e);if("GET"===i&&a===this.routes.callback)return this.handleCallback(e);if("GET"===i&&a===this.routes.profile)return this.handleProfile(e);if("GET"===i&&a===this.routes.accessToken&&this.enableAccessTokenEndpoint)return this.handleAccessToken(e);if("POST"===i&&a===this.routes.backChannelLogout)return this.handleBackChannelLogout(e);if("GET"===i&&a===this.routes.connectAccount&&this.enableConnectAccountEndpoint)return this.handleConnectAccount(e);if(a.startsWith("/me/"))return this.handleMyAccount(e);if(a.startsWith("/my-org/"))return this.handleMyOrg(e);let t=D.NextResponse.next(),r=await this.sessionStore.get(e.cookies);return r&&(await this.sessionStore.set(e.cookies,t.cookies,{...r}),aH(t)),t}}async startInteractiveLogin(e={}){let t=aW(this.routes.callback,this.appBaseUrl),r=this.signInReturnToPath;if(e.returnTo){let t=new URL(this.authorizationParameters.redirect_uri||this.appBaseUrl),n=nj(e.returnTo,t);n&&(r=n.pathname+n.search+n.hash)}let n=eO(),a=await ex(n),i=eO(),s=eO(),o=nx(this.authorizationParameters,e.authorizationParameters,aj);if(o.set("client_id",this.clientMetadata.client_id),o.set("redirect_uri",t.toString()),o.set("response_type",_.CODE),o.set("code_challenge",a),o.set("code_challenge_method","S256"),o.set("state",i),o.set("nonce",s),this.dpopKeyPair)try{let e=await rw(this.dpopKeyPair.publicKey),t=await rN(e);o.set("dpop_jkt",t)}catch(e){throw new V(E.DPOP_JKT_CALCULATION_FAILED,"DPoP is enabled but failed to calculate key thumbprint (dpop_jkt). This is required for secure DPoP binding. Please check your key configuration.",e instanceof Error?e:void 0)}let c={nonce:s,maxAge:this.authorizationParameters.max_age,codeVerifier:n,responseType:_.CODE,state:i,returnTo:r,scope:o.get("scope")||void 0,audience:o.get("audience")||void 0},[u,l]=await this.authorizationUrl(o);if(u)return new D.NextResponse("An error occurred while trying to initiate the login request.",{status:500});let d=D.NextResponse.redirect(l.toString());return await this.transactionStore.save(d.cookies,c),d}async handleLogin(e){let{returnTo:t,...r}=Object.fromEntries(e.nextUrl.searchParams.entries());return this.startInteractiveLogin({authorizationParameters:r,returnTo:t})}async handleLogout(e){let t,r=await this.sessionStore.get(e.cookies),[n,a]=await this.discoverAuthorizationServerMetadata();if(n){let t=new D.NextResponse("An error occurred while trying to initiate the logout request.",{status:500});return await this.sessionStore.delete(e.cookies,t.cookies),await this.transactionStore.deleteAll(e.cookies,t.cookies),t}let i=e.nextUrl.searchParams.get("returnTo")||this.appBaseUrl,s=e.nextUrl.searchParams.has("federated"),o=()=>{let e=new URL("/v2/logout",this.issuer);return e.searchParams.set("returnTo",i),e.searchParams.set("client_id",this.clientMetadata.client_id),s&&e.searchParams.set("federated",""),D.NextResponse.redirect(e)},c=()=>{let e=new URL(a.end_session_endpoint);return e.searchParams.set("client_id",this.clientMetadata.client_id),e.searchParams.set("post_logout_redirect_uri",i),r?.internal.sid&&e.searchParams.set("logout_hint",r.internal.sid),this.includeIdTokenHintInOIDCLogoutUrl&&r?.tokenSet.idToken&&e.searchParams.set("id_token_hint",r.tokenSet.idToken),s&&e.searchParams.set("federated",""),D.NextResponse.redirect(e)};if("v2"===this.logoutStrategy)t=o();else if("oidc"===this.logoutStrategy){if(!a.end_session_endpoint){let t=new D.NextResponse("OIDC RP-Initiated Logout is not supported by the authorization server. Enable it or use a different logout strategy.",{status:500});return await this.sessionStore.delete(e.cookies,t.cookies),await this.transactionStore.deleteAll(e.cookies,t.cookies),t}t=c()}else a.end_session_endpoint?t=c():(console.warn("The Auth0 client does not have RP-initiated logout enabled, the user will be redirected to the `/v2/logout` endpoint instead. Learn how to enable it here: https://auth0.com/docs/authenticate/login/logout/log-users-out-of-auth0#enable-endpoint-discovery"),t=o());return await this.sessionStore.delete(e.cookies,t.cookies),aH(t),await this.transactionStore.deleteAll(e.cookies,t.cookies),t}async handleCallback(e){let t,r,n,a,i,s=e.nextUrl.searchParams.get("state");if(!s)return this.handleCallbackError(new N,{},e);let o=await this.transactionStore.get(e.cookies,s);if(!o)return this.onCallback(new M,{},null);let c=o.payload,u={responseType:c.responseType,returnTo:c.returnTo};if(c.responseType===_.CONNECT_CODE){let t=await this.sessionStore.get(e.cookies);if(!t)return this.handleCallbackError(new Y({code:A.MISSING_SESSION,message:"The user does not have an active session."}),u,e,s);let[r,n]=await this.getTokenSet(t,{audience:`${this.issuer}/me/`,scope:"create:me:connected_accounts"});if(r)return this.handleCallbackError(r,u,e,s);let[a,i]=await this.completeConnectAccount({tokenSet:n.tokenSet,authSession:c.authSession,connectCode:e.nextUrl.searchParams.get("connect_code"),redirectUri:aW(this.routes.callback,this.appBaseUrl).toString(),codeVerifier:c.codeVerifier});if(a)return this.handleCallbackError(a,u,e,s);let o=await this.onCallback(null,{...u,connectedAccount:i},t);return await this.transactionStore.delete(o.cookies,s),o}let[l,d]=await this.discoverAuthorizationServerMetadata();if(l)return this.handleCallbackError(l,u,e,s);try{t=function(e,t,r,n){var a;if(eK(e),eN(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw en('"parameters" must be an instance of URLSearchParams, or URL',er);if(t$(r,"response"))throw em('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',tT,{parameters:r});let i=t$(r,"iss"),s=t$(r,"state");if(!i&&e.authorization_response_iss_parameter_supported)throw em('response parameter "iss" (issuer) missing',tT,{parameters:r});if(i&&i!==e.issuer)throw em('unexpected "iss" (issuer) response parameter value',tT,{expected:e.issuer,parameters:r});switch(n){case void 0:case tq:if(void 0!==s)throw em('unexpected "state" response parameter encountered',tT,{expected:void 0,parameters:r});break;case tJ:break;default:if(eP(n,'"expectedState" argument'),s!==n)throw em(void 0===s?'response parameter "state" missing':'unexpected "state" response parameter value',tT,{expected:n,parameters:r})}if(t$(r,"error"))throw new eY("authorization response from the server is an error",{cause:r});let o=t$(r,"id_token"),c=t$(r,"token");if(void 0!==o||void 0!==c)throw new ef("implicit and hybrid flows are not supported");return a=new URLSearchParams(r),td.add(a),a}(d,this.clientMetadata,e.nextUrl.searchParams,c.state)}catch(t){return this.handleCallbackError(new W({cause:new U({code:t.error,message:t.error_description})}),u,e,s)}try{n=aW(this.routes.callback,this.appBaseUrl);let e=this.useDPoP&&this.dpopKeyPair?eV(this.clientMetadata,this.dpopKeyPair):void 0;a=async()=>tp(d,this.clientMetadata,await this.getClientAuth(),t,n.toString(),c.codeVerifier,{...this.httpOptions(),[eo]:this.fetch,[ea]:this.allowInsecureRequests,...e&&{DPoP:e}}),r=await t0(a,{isDPoPEnabled:!!e,...this.dpopOptions?.retry})}catch(t){return this.handleCallbackError(new L(t.message),u,e,s)}try{i=await tg(d,this.clientMetadata,r,{expectedNonce:c.nonce,maxAge:c.maxAge,requireIdToken:!0})}catch(t){return this.handleCallbackError(new $({cause:new U({code:t.error,message:t.error_description})}),u,e,s)}let h=ti(i),p={user:h,tokenSet:{accessToken:i.access_token,idToken:i.id_token,scope:i.scope,requestedScope:c.scope,audience:c.audience,refreshToken:i.refresh_token,expiresAt:Math.floor(Date.now()/1e3)+Number(i.expires_in)},internal:{sid:h.sid,createdAt:Math.floor(Date.now()/1e3)}},f=await this.onCallback(null,u,p);return p=await this.finalizeSession(p,i.id_token),await this.sessionStore.set(e.cookies,f.cookies,p,!0),aH(f),await this.transactionStore.delete(f.cookies,s),f}async handleProfile(e){let t=await this.sessionStore.get(e.cookies);if(!t)return this.noContentProfileResponseWhenUnauthenticated?new D.NextResponse(null,{status:204}):new D.NextResponse(null,{status:401});let r=D.NextResponse.json(t?.user);return aH(r),r}async handleAccessToken(e){let t=await this.sessionStore.get(e.cookies),r=e.nextUrl.searchParams.get("audience"),n=e.nextUrl.searchParams.get("scope");if(!t)return D.NextResponse.json({error:{message:"The user does not have an active session.",code:g.MISSING_SESSION}},{status:401});let[a,i]=await this.getTokenSet(t,{scope:n,audience:r});if(a)return D.NextResponse.json({error:{message:a.message,code:a.code}},{status:401});let{tokenSet:s}=i,o=D.NextResponse.json({token:s.accessToken,scope:s.scope,expires_at:s.expiresAt,...s.token_type&&{token_type:s.token_type}});return await aM(this,v,"m",R).call(this,e,o,t,i),o}async handleBackChannelLogout(e){if(!this.sessionStore.store)return new D.NextResponse("A session data store is not configured.",{status:500});if(!this.sessionStore.store.deleteByLogoutToken)return new D.NextResponse("Back-channel logout is not supported by the session data store.",{status:500});let t=new URLSearchParams(await e.text()).get("logout_token");if(!t)return new D.NextResponse("Missing `logout_token` in the request body.",{status:400});let[r,n]=await this.verifyLogoutToken(t);return r?new D.NextResponse(r.message,{status:400}):(await this.sessionStore.store.deleteByLogoutToken(n),new D.NextResponse(null,{status:204}))}async handleConnectAccount(e){let t=await this.sessionStore.get(e.cookies),r=e.nextUrl.searchParams.get("connection"),n=e.nextUrl.searchParams.get("returnTo")??void 0,a=e.nextUrl.searchParams.getAll("scopes"),i=Object.fromEntries([...e.nextUrl.searchParams.entries()].filter(([e])=>"connection"!==e&&"returnTo"!==e&&"scopes"!==e));if(!r)return new D.NextResponse("A connection is required.",{status:400});if(!t)return new D.NextResponse("The user does not have an active session.",{status:401});let[s,o]=await this.getTokenSet(t,{scope:"create:me:connected_accounts",audience:`${this.issuer}/me/`});if(s)return new D.NextResponse("Failed to retrieve a connected account access token.",{status:401});let{tokenSet:c}=o,u={connection:r,authorizationParams:i,returnTo:n};a.length>0&&(u.scopes=a);let[l,d]=await this.connectAccount({tokenSet:c,...u});return l?new D.NextResponse(l.message,{status:l.cause?.status??500}):(await aM(this,v,"m",R).call(this,e,d,t,o),d)}async handleMyAccount(e){return aM(this,v,"m",C).call(this,e,{proxyPath:"/me",targetBaseUrl:`${this.issuer}/me/v1`,audience:`${this.issuer}/me/`,scope:e.headers.get("scope")})}async handleMyOrg(e){return aM(this,v,"m",C).call(this,e,{proxyPath:"/my-org",targetBaseUrl:`${this.issuer}/my-org`,audience:`${this.issuer}/my-org/`,scope:e.headers.get("scope")})}async getTokenSet(e,t={}){let r=t6(t1(this.authorizationParameters.scope,t.audience??this.authorizationParameters.audience),t.scope),n=aM(this,v,"m",T).call(this,e,{scope:r,audience:t.audience??this.authorizationParameters.audience});if(!n.refreshToken&&!n.accessToken)return[new B(g.MISSING_REFRESH_TOKEN,"No access token found and a refresh token was not provided. The user needs to re-authenticate."),null];if(!n.refreshToken&&n.accessToken&&n.expiresAt&&n.expiresAt<=Date.now()/1e3)return[new B(g.MISSING_REFRESH_TOKEN,"The access token has expired and a refresh token was not provided. The user needs to re-authenticate."),null];if(n.refreshToken&&(t.refresh||!n.expiresAt||n.expiresAt<=Date.now()/1e3)){let[e,a]=await aM(this,v,"m",O).call(this,n,{audience:t.audience,scope:t.scope?r:void 0,requestedScope:r});return e?[e,null]:[null,{tokenSet:a.updatedTokenSet,idTokenClaims:a.idTokenClaims}]}return[null,{tokenSet:n,idTokenClaims:void 0}]}async backchannelAuthentication(e){let[t,r]=await this.discoverAuthorizationServerMetadata();if(t)return[t,null];if(!r.backchannel_authentication_endpoint)return[new q,null];let n=nx(this.authorizationParameters,e.authorizationParams,aj);n.get("scope")||n.set("scope",Z),n.set("client_id",this.clientMetadata.client_id),n.set("binding_message",e.bindingMessage),n.set("login_hint",JSON.stringify({format:"iss_sub",iss:r.issuer,sub:e.loginHint.sub})),e.requestedExpiry&&n.append("requested_expiry",e.requestedExpiry.toString()),e.authorizationDetails&&n.append("authorization_details",JSON.stringify(e.authorizationDetails));let[a,i]=await this.getOpenIdClientConfig();if(a)return[a,null];try{let e=await nv(i,n),t=await nT(i,e),r=Math.floor(Date.now()/1e3)+Number(t.expires_in);return[null,{tokenSet:{accessToken:t.access_token,idToken:t.id_token,scope:t.scope,refreshToken:t.refresh_token,expiresAt:r},idTokenClaims:t.claims(),authorizationDetails:t.authorization_details}]}catch(e){return[new z({cause:new U({code:e.error,message:e.error_description})}),null]}}async discoverAuthorizationServerMetadata(){if(this.authorizationServerMetadata)return[null,this.authorizationServerMetadata];let e=new URL(this.issuer);try{let t=await ev(e,{...this.httpOptions(),[eo]:this.fetch,[ea]:this.allowInsecureRequests}).then(t=>eC(e,t));return this.authorizationServerMetadata=t,[null,t]}catch(t){return console.error(`An error occurred while performing the discovery request. issuer=${e.toString()}, error:`,t),[new K("Discovery failed for the OpenID Connect configuration."),null]}}async defaultOnCallback(e,t){return e?new D.NextResponse(e.message,{status:500}):D.NextResponse.redirect(aW(t.returnTo||"/",this.appBaseUrl))}async handleCallbackError(e,t,r,n){let a=await this.onCallback(e,t,null);return n&&await this.transactionStore.delete(a.cookies,n),a}async verifyLogoutToken(e){let t,r,[n,a]=await this.discoverAuthorizationServerMetadata();if(n)return[n,null];let i=(t=new rQ(new URL(a.jwks_uri),{[rZ]:this.jwksCache}),Object.defineProperties(r=async(e,r)=>t.getKey(e,r),{coolingDown:{get:()=>t.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>t.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>t.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>t.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>t.jwks(),enumerable:!0,configurable:!1,writable:!1}}),r),{payload:s}=await nf(e,i,{issuer:a.issuer,audience:this.clientMetadata.client_id,algorithms:["RS256"],requiredClaims:["iat"]});return"sid"in s||"sub"in s?"sid"in s&&"string"!=typeof s.sid?[new J('"sid" claim must be a string'),null]:"sub"in s&&"string"!=typeof s.sub?[new J('"sub" claim must be a string'),null]:"nonce"in s?[new J('"nonce" claim is prohibited'),null]:"events"in s?"object"!=typeof s.events||null===s.events?[new J('"events" claim must be an object'),null]:"http://schemas.openid.net/event/backchannel-logout"in s.events?"object"!=typeof s.events["http://schemas.openid.net/event/backchannel-logout"]?[new J('"http://schemas.openid.net/event/backchannel-logout" member in the "events" claim must be an object'),null]:[null,{sid:s.sid,sub:s.sub}]:[new J('"http://schemas.openid.net/event/backchannel-logout" member is missing in the "events" claim'),null]:[new J('"events" claim is missing'),null]:[new J('either "sid" or "sub" (or both) claims must be present'),null]}async authorizationUrl(e){let[t,r]=await this.discoverAuthorizationServerMetadata();if(t)return[t,null];if(this.pushedAuthorizationRequests&&!r.pushed_authorization_request_endpoint)return console.error("The Auth0 tenant does not have pushed authorization requests enabled. Learn how to enable it here: https://auth0.com/docs/get-started/applications/configure-par"),[Error("The authorization server does not support pushed authorization requests."),null];let n=new URL(r.authorization_endpoint);if(this.pushedAuthorizationRequests){let t,a=await eB(r,this.clientMetadata,await this.getClientAuth(),e,{...this.httpOptions(),[eo]:this.fetch,[ea]:this.allowInsecureRequests});try{t=await e8(r,this.clientMetadata,a)}catch(e){return[new W({cause:new U({code:e.error,message:e.error_description}),message:"An error occurred while pushing the authorization request."}),null]}return n.searchParams.set("request_uri",t.request_uri),n.searchParams.set("client_id",this.clientMetadata.client_id),[null,n]}return n.search=e.toString(),[null,n]}async getClientAuth(){if(!this.clientSecret&&!this.clientAssertionSigningKey)throw Error("The client secret or client assertion signing key must be provided.");let e=this.clientAssertionSigningKey;return e&&"string"==typeof e&&(e=await rq(e,this.clientAssertionSigningAlg)),e?function(e,t){let{key:r,kid:n}=e instanceof CryptoKey?{key:e}:e?.key instanceof CryptoKey?(void 0!==e.kid&&eP(e.kid,'"kid"'),{key:e.key,kid:e.kid}):{};return eb(r,'"clientPrivateKey.key"'),async(e,t,a,i)=>{let s,o={alg:eI(r),kid:n},c=(s=eU()+eD(t),{jti:eO(),aud:e.issuer,exp:s+60,iat:s,nbf:s,iss:t.client_id,sub:t.client_id});a.set("client_id",t.client_id),a.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),a.set("client_assertion",await ej(o,c,r))}}(e):eM(this.clientSecret)}get issuer(){return this.domain.startsWith("http://")||this.domain.startsWith("https://")?this.domain:`https://${this.domain}`}async getConnectionTokenSet(e,t,r){if(!e.refreshToken&&(!t||t.expiresAt<=Date.now()/1e3))return[new F(b.MISSING_REFRESH_TOKEN,"A refresh token was not present, Connection Access Token requires a refresh token. The user needs to re-authenticate."),null];if(e.refreshToken&&(!t||t.expiresAt<=Date.now()/1e3)){let t,n=new URLSearchParams;n.append("connection",r.connection);let a=r.subject_token_type??k.SUBJECT_TYPE_REFRESH_TOKEN,i=a===k.SUBJECT_TYPE_ACCESS_TOKEN?e.accessToken:e.refreshToken;n.append("subject_token_type",a),n.append("subject_token",i),n.append("requested_token_type","http://auth0.com/oauth/token-type/federated-connection-access-token"),r.login_hint&&n.append("login_hint",r.login_hint);let[s,o]=await this.discoverAuthorizationServerMetadata();if(s)return[s,null];let c=this.useDPoP&&this.dpopKeyPair?eV(this.clientMetadata,this.dpopKeyPair):void 0,u=async()=>tK(o,this.clientMetadata,await this.getClientAuth(),"urn:auth0:params:oauth:grant-type:token-exchange:federated-connection-access-token",n,{[eo]:this.fetch,[ea]:this.allowInsecureRequests,...c&&{DPoP:c}}),l=async()=>{let e=await u();return tN(o,this.clientMetadata,e)};try{t=await t0(l,{isDPoPEnabled:!!(this.useDPoP&&this.dpopKeyPair),...this.dpopOptions?.retry})}catch(e){return[new F(b.FAILED_TO_EXCHANGE,"There was an error trying to exchange the refresh token for a connection access token.",new U({code:e.error,message:e.error_description})),null]}return[null,{accessToken:t.access_token,expiresAt:Math.floor(Date.now()/1e3)+Number(t.expires_in),scope:t.scope,connection:r.connection}]}return[null,t]}validateSubjectTokenType(e){if(e.length<10)return new G(S.INVALID_SUBJECT_TOKEN_TYPE,`Invalid subject_token_type: must be at least 10 characters. Received ${e.length} characters.`);if(e.length>100)return new G(S.INVALID_SUBJECT_TOKEN_TYPE,`Invalid subject_token_type: must be at most 100 characters. Received ${e.length} characters.`);let t=!1;try{new URL(e),t=!0}catch{}let r=/^urn:[a-z0-9][a-z0-9-]{0,31}:[a-z0-9()+,\-.:=@;$_!*'%/?#]+$/i.test(e);return t||r?null:new G(S.INVALID_SUBJECT_TOKEN_TYPE,`Invalid subject_token_type: must be a valid URI (URL or URN format). Received: "${e}"`)}async customTokenExchange(e){let t;if(!e.subjectToken||""===e.subjectToken.trim())return[new G(S.MISSING_SUBJECT_TOKEN,"The subject_token is required and cannot be empty."),null];let r=this.validateSubjectTokenType(e.subjectTokenType);if(r)return[r,null];if(e.actorToken&&!e.actorTokenType)return[new G(S.MISSING_ACTOR_TOKEN_TYPE,"The actor_token_type is required when actor_token is provided."),null];let[n,a]=await this.discoverAuthorizationServerMetadata();if(n)return[new G(S.EXCHANGE_FAILED,"Failed to discover authorization server metadata.",new U({code:"discovery_error",message:n.message})),null];let i=t6(Z,e.scope),s=new URLSearchParams;if(s.append("subject_token",e.subjectToken),s.append("subject_token_type",e.subjectTokenType),s.append("scope",i),e.audience&&s.append("audience",e.audience),e.organization&&s.append("organization",e.organization),e.actorToken&&e.actorTokenType&&(s.append("actor_token",e.actorToken),s.append("actor_token_type",e.actorTokenType)),e.additionalParameters)for(let[t,r]of Object.entries(e.additionalParameters))null!=r&&s.append(t,String(r));let o=this.useDPoP&&this.dpopKeyPair?eV(this.clientMetadata,this.dpopKeyPair):void 0,c=async()=>{let e=await tK(a,this.clientMetadata,await this.getClientAuth(),"urn:ietf:params:oauth:grant-type:token-exchange",s,{[eo]:this.fetch,[ea]:this.allowInsecureRequests,...o&&{DPoP:o}});return tN(a,this.clientMetadata,e)};try{t=await t0(c,{isDPoPEnabled:!!(this.useDPoP&&this.dpopKeyPair),...this.dpopOptions?.retry})}catch(e){return[new G(S.EXCHANGE_FAILED,"There was an error trying to exchange the token.",new U({code:e.error??"unknown_error",message:e.error_description??e.message})),null]}return[null,{accessToken:t.access_token,idToken:t.id_token,refreshToken:t.refresh_token,tokenType:t.token_type??"Bearer",expiresIn:Number(t.expires_in),scope:t.scope}]}async finalizeSession(e,t){if(this.beforeSessionSaved)e={...await this.beforeSessionSaved(e,t??null),internal:e.internal};else{var r;e.user=Object.keys(r=e.user).reduce((e,t)=>(aN.includes(t)&&(e[t]=r[t]),e),{})}return e}async connectAccount(e){let t=aW(this.routes.callback,this.appBaseUrl),r=this.signInReturnToPath;if(e.returnTo){let t=new URL(this.authorizationParameters.redirect_uri||this.appBaseUrl),n=nj(e.returnTo,t);n&&(r=n.pathname+n.search+n.hash)}let n=eO(),a=await ex(n),i=eO(),[s,o]=await this.createConnectAccountTicket({tokenSet:e.tokenSet,connection:e.connection,redirectUri:t.toString(),state:i,codeChallenge:a,codeChallengeMethod:"S256",scopes:e.scopes,authorizationParams:e.authorizationParams});if(s)return[s,null];let c={codeVerifier:n,responseType:_.CONNECT_CODE,state:i,returnTo:r,authSession:o.authSession},u=D.NextResponse.redirect(`${o.connectUri}?ticket=${encodeURIComponent(o.connectParams.ticket)}`);return await this.transactionStore.save(u.cookies,c),[null,u]}async createConnectAccountTicket(e){try{let t=new URL("/me/v1/connected-accounts/connect",this.issuer),r=await this.fetcherFactory({useDPoP:this.useDPoP,getAccessToken:async()=>({accessToken:e.tokenSet.accessToken,expiresAt:e.tokenSet.expiresAt||0,scope:e.tokenSet.scope,token_type:e.tokenSet.token_type}),fetch:this.fetch}),n=this.httpOptions();new Headers(n.headers).set("Content-Type","application/json");let a={connection:e.connection,redirect_uri:e.redirectUri,state:e.state,code_challenge:e.codeChallenge,code_challenge_method:e.codeChallengeMethod,scopes:e.scopes,authorization_params:e.authorizationParams},i=await r.fetchWithAuth(t.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)return aJ(i,A.FAILED_TO_INITIATE);let{connect_uri:s,connect_params:o,auth_session:c,expires_in:u}=await i.json();return[null,{connectUri:s,connectParams:o,authSession:c,expiresIn:u}]}catch(t){let e="An unexpected error occurred while trying to initiate the connect account flow.";return t instanceof V&&(e=t.message),[new Y({code:A.FAILED_TO_INITIATE,message:e}),null]}}async completeConnectAccount(e){let t=new URL("/me/v1/connected-accounts/complete",this.issuer);try{let r=this.httpOptions();new Headers(r.headers).set("Content-Type","application/json");let n=await this.fetcherFactory({useDPoP:this.useDPoP,getAccessToken:async()=>({accessToken:e.tokenSet.accessToken,expiresAt:e.tokenSet.expiresAt||0,scope:e.tokenSet.scope,token_type:e.tokenSet.token_type}),fetch:this.fetch}),a={auth_session:e.authSession,connect_code:e.connectCode,redirect_uri:e.redirectUri,code_verifier:e.codeVerifier},i=await n.fetchWithAuth(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)return aJ(i,A.FAILED_TO_COMPLETE);let{id:s,connection:o,access_type:c,scopes:u,created_at:l,expires_at:d}=await i.json();return[null,{id:s,connection:o,accessType:c,scopes:u,createdAt:l,expiresAt:d}]}catch(e){return[new Y({code:A.FAILED_TO_COMPLETE,message:"An unexpected error occurred while trying to complete the connect account flow."}),null]}}async getOpenIdClientConfig(){let[e,t]=await this.discoverAuthorizationServerMetadata();if(e)return[e,null];let r=new nA(t,this.clientMetadata.client_id,{},await this.getClientAuth()),n=new Headers(this.httpOptions().headers);return r[eo]=(...e)=>{let t=new Headers(e[1].headers);return this.fetch(e[0],{...e[1],body:e[1].body,headers:new Headers([...n,...t])})},r.timeout=this.httpTimeout,this.allowInsecureRequests&&(c.get(r).tlsOnly=!1),[null,r]}async fetcherFactory(e){if(this.useDPoP&&!this.dpopKeyPair)throw new V(E.DPOP_CONFIGURATION_ERROR,"DPoP is enabled but no keypair is configured.");let[t,r]=await this.discoverAuthorizationServerMetadata();if(t)throw t;return new aK({dpopHandle:this.useDPoP&&(e.useDPoP??!0)?eV(this.clientMetadata,this.dpopKeyPair):void 0,httpOptions:this.httpOptions,allowInsecureRequests:this.allowInsecureRequests,retryConfig:this.dpopOptions?.retry,fetch:e.fetch,getAccessToken:e.getAccessToken,baseUrl:e.baseUrl},{getAccessToken:e.getAccessToken,isDpopEnabled:()=>e.useDPoP??this.useDPoP??!1})}}v=new WeakSet,T=function(e,t){var r;let n,a=e.tokenSet,i=t.audience,s=t.scope,o=!i||i===(a.audience||this.authorizationParameters.audience),c=!s||t8(a.requestedScope||t1(this.authorizationParameters.scope,i),s);return o&&c?a:(i&&(n=t4(e,{scope:s,audience:i})),r=n,{...a,accessToken:r?.accessToken,expiresAt:r?.expiresAt,scope:r?.scope,requestedScope:r?.requestedScope,audience:r?.audience,...r?.token_type&&{token_type:r.token_type}})},P=async function(e,t){let r=nK(e),n=nM(e,t);r.set("host",n.host);try{let e=await this.fetch(n.toString(),{method:"OPTIONS",headers:r});return new D.NextResponse(null,{status:e.status,headers:nN(e)})}catch(e){return new D.NextResponse(e.cause||e.message||"Preflight request failed",{status:500})}},C=async function(e,t){let r,n=await this.sessionStore.get(e.cookies);if(!n)return new D.NextResponse("The user does not have an active session.",{status:401});if("OPTIONS"===e.method&&e.headers.has("access-control-request-method"))return aM(this,v,"m",P).call(this,e,t);let a=nK(e),i=this.useDPoP?e.clone():e,s=nM(e,t);a.set("host",s.host);let o=i.body?await i.arrayBuffer():void 0,c=async e=>{let[t,a]=await this.getTokenSet(n,{audience:e.audience,scope:e.scope});if(t)throw t;return r=a,a.tokenSet},u=this.proxyFetchers[t.audience];u?u.getAccessToken=c:(u=await this.fetcherFactory({useDPoP:this.useDPoP,fetch:this.fetch,getAccessToken:c}),this.proxyFetchers[t.audience]=u);try{let c=await u.fetchWithAuth(s.toString(),{method:i.method,headers:a,body:o},{scope:t.scope,audience:t.audience}),l=new D.NextResponse(c.body,{status:c.status,statusText:c.statusText,headers:nN(c)});return r&&await aM(this,v,"m",R).call(this,e,l,n,r),l}catch(e){if(e instanceof B&&e.code===g.MISSING_REFRESH_TOKEN)return new D.NextResponse(e.message,{status:401});return new D.NextResponse(e.cause||e.message||"An error occurred while proxying the request.",{status:500})}},R=async function(e,t,r,n){let a=t9(r,n.tokenSet,{scope:this.authorizationParameters?.scope??Z,audience:this.authorizationParameters?.audience});if(a){n.idTokenClaims&&(r.user=n.idTokenClaims);let i=await this.finalizeSession({...r,...a},n.tokenSet.idToken);await this.sessionStore.set(e.cookies,t.cookies,i),aH(t)}},O=async function(e,t){let r,[n,a]=await this.discoverAuthorizationServerMetadata();if(n)return[n,null];let i=new URLSearchParams;t.scope&&i.append("scope",t.scope),t.audience&&i.append("audience",t.audience);let s=this.useDPoP&&this.dpopKeyPair?eV(this.clientMetadata,this.dpopKeyPair):void 0,o=async()=>tr(a,this.clientMetadata,await this.getClientAuth(),e.refreshToken,{...this.httpOptions(),[eo]:this.fetch,[ea]:this.allowInsecureRequests,additionalParameters:i,...s&&{DPoP:s}}),c=e=>tc(a,this.clientMetadata,e);try{r=await t0(async()=>{let e=await o();return await c(e)},{isDPoPEnabled:!!(this.useDPoP&&this.dpopKeyPair),...this.dpopOptions?.retry})}catch(e){return[new B(g.FAILED_TO_REFRESH_TOKEN,"The access token has expired and there was an error while trying to refresh it.",new U({code:e.error,message:e.error_description})),null]}let u=ti(r),l=Math.floor(Date.now()/1e3)+Number(r.expires_in),d={...e,accessToken:r.access_token,idToken:r.id_token,scope:r.scope,requestedScope:t.requestedScope,expiresAt:l,audience:e.audience||t.audience||void 0,...r.token_type&&{token_type:r.token_type}};return r.refresh_token?d.refreshToken=r.refresh_token:d.refreshToken=e.refreshToken,[null,{updatedTokenSet:d,idTokenClaims:u}]};let a$=e=>{let t=new TextEncoder().encode(e),r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))};async function aJ(e,t){let r=t===A.FAILED_TO_INITIATE?"initiate":"complete";try{let n=await e.json();return[new Y({code:t,message:`The request to ${r} the connect account flow failed with status ${e.status}.`,cause:new X({type:n.type,title:n.title,detail:n.detail,status:e.status,validationErrors:n.validation_errors})}),null]}catch(n){return[new Y({code:t,message:`The request to ${r} the connect account flow failed with status ${e.status}.`}),null]}}function aq(e){if(e instanceof D.NextRequest)return e;let t=function(e){let t;try{let r=e.nextUrl;if(!r)return;"string"==typeof r.basePath&&r.basePath&&(t={basePath:r.basePath}),("string"==typeof r.locale||"string"==typeof r.defaultLocale)&&(t={...t||{},i18n:{locales:r.locale?[r.locale]:[],defaultLocale:r.defaultLocale}}),"boolean"==typeof r.trailingSlash&&(t={...t||{},trailingSlash:r.trailingSlash})}catch{}return t&&Object.keys(t).length?t:void 0}(e),r={method:e.method,headers:e.headers,body:e.body,duplex:e.duplex??"half"};return t&&(r.nextConfig=t),new D.NextRequest(e.url,r)}class az{constructor({secret:e,rolling:t=!0,absoluteDuration:r=259200,inactivityDuration:n=86400,store:a,cookieOptions:i}){this.secret=e,this.rolling=t,this.absoluteDuration=r,this.inactivityDuration=n,this.store=a,this.sessionCookieName=i?.name??"__session",this.cookieConfig={httpOnly:!0,sameSite:i?.sameSite??"lax",secure:i?.secure??!1,path:i?.path??"/",domain:i?.domain,transient:i?.transient}}epoch(){return Date.now()/1e3|0}calculateMaxAge(e){if(!this.rolling)return this.absoluteDuration;let t=this.epoch(),r=Math.min(t+this.inactivityDuration,e+this.absoluteDuration)-t;return r>0?r:0}}let aB="appSession";function aF(e,t){let r=t.user;return{user:r,tokenSet:{idToken:t.idToken??void 0,accessToken:t.accessToken??void 0,scope:t.accessTokenScope,refreshToken:t.refreshToken,expiresAt:t.accessTokenExpiresAt},internal:{sid:r.sid,createdAt:e.iat}}}let aG=()=>{let e=new Uint8Array(16);return crypto.getRandomValues(e),Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join("")};class aV extends az{constructor({secret:e,store:t,rolling:r,absoluteDuration:n,inactivityDuration:a,cookieOptions:i}){super({secret:e,rolling:r,absoluteDuration:n,inactivityDuration:a,cookieOptions:i}),this.store=t}async get(e){let t=e.get(this.sessionCookieName)||e.get(aB);if(!t||!t.value)return null;let r=null;try{let e=await aT(t.value,this.secret);if(null===e)return null;r=e.payload.id}catch(e){if("ERR_JWE_INVALID"===e.code){let e=await aP(t.name,t.value,this.secret);if(!e)return null;r=e}}if(!r)return null;let n=await this.store.get(r);return n?n.header?.iat?aF(n.header,n.data):n:null}async set(e,t,r,n=!1){let a=null,i=e.get(this.sessionCookieName)?.value;if(i){let e=await aT(i,this.secret);e&&(a=e.payload.id)}a&&n&&(await this.store.delete(a),a=aG()),a||(a=aG());let s=this.calculateMaxAge(r.internal.createdAt),o=this.epoch(),c=await av({id:a},this.secret,o+s);t.set(this.sessionCookieName,c.toString(),{...this.cookieConfig,maxAge:s}),await this.store.set(a,r),e.set(this.sessionCookieName,c.toString()),this.sessionCookieName!==aB&&e.has(aB)&&aU(t,aB,{domain:this.cookieConfig.domain,path:this.cookieConfig.path})}async delete(e,t){let r=e.get(this.sessionCookieName)?.value;if(aU(t,this.sessionCookieName,{domain:this.cookieConfig.domain,path:this.cookieConfig.path}),!r)return;let n=await aT(r,this.secret);n&&await this.store.delete(n.payload.id)}}class aX extends az{constructor({secret:e,rolling:t,absoluteDuration:r,inactivityDuration:n,cookieOptions:a}){super({secret:e,rolling:t,absoluteDuration:r,inactivityDuration:n,cookieOptions:a}),this.connectionTokenSetsCookieName="__FC"}async get(e){let t=aI(this.sessionCookieName,e)??aI(aB,e,!0);if(!t)return null;let r=await aT(t,this.secret);if(!r)return null;let n=r.protectedHeader.iat?aF(r.protectedHeader,r.payload):r.payload,a=this.getConnectionTokenSetsCookies(e),i=[];for(let e of a){let t=await aT(e.value,this.secret);t&&i.push(t.payload)}return{...n,...i.length?{connectionTokenSets:i}:{}}}async set(e,t,r){let{connectionTokenSets:n,...a}=r,i=this.calculateMaxAge(r.internal.createdAt),s=this.epoch(),o=(await av(a,this.secret,s+i)).toString(),c={...this.cookieConfig,maxAge:i};!function(e,t,r,n,a){let{transient:i,...s}=r,o={...s};if(i&&delete o.maxAge,new TextEncoder().encode(t).length<=3500){a.set(e,t,o),n.set(e,t),ax(n,e).forEach(e=>{aU(a,e.name,{path:o.path,domain:o.domain}),n.delete(e.name)});return}let c=0,u=0;for(;c<t.length;){let r=t.slice(c,c+3500),i=`${e}__${u}`;a.set(i,r,o),n.set(i,r),c+=3500,u++}let l=ax(n,e).length-u;if(l>0)for(let t=0;t<l;t++){let r=u+t,i=`${e}__${r}`;aU(a,i,{path:o.path,domain:o.domain}),n.delete(i)}aU(a,e,{path:o.path,domain:o.domain}),n.delete(e)}(this.sessionCookieName,o,c,e,t),n?.length&&await Promise.all(n.map((r,n)=>this.storeInCookie(e,t,r,`${this.connectionTokenSetsCookieName}_${n}`,i))),aI(aB,e,!0)&&aD(aB,e,t,!0,{domain:this.cookieConfig.domain,path:this.cookieConfig.path})}async delete(e,t){let r={domain:this.cookieConfig.domain,path:this.cookieConfig.path};aD(this.sessionCookieName,e,t,!1,r),this.getConnectionTokenSetsCookies(e).forEach(e=>aU(t,e.name,r))}async storeInCookie(e,t,r,n,a){let i=Math.floor(Date.now()/1e3+a),s=await av(r,this.secret,i),o=s.toString();t.set(n,s.toString(),{...this.cookieConfig,maxAge:a}),e.set(n,o);let c=new nz(new Headers);c.set(n,o,{...this.cookieConfig,maxAge:a}),new TextEncoder().encode(c.toString()).length>=4096&&(n===this.sessionCookieName?console.warn(`The ${n} cookie size exceeds 4096 bytes, which may cause issues in some browsers. Consider removing any unnecessary custom claims from the access token or the user profile. Alternatively, you can use a stateful session implementation to store the session data in a data store.`):console.warn(`The ${n} cookie size exceeds 4096 bytes, which may cause issues in some browsers. You can use a stateful session implementation to store the session data in a data store.`))}getConnectionTokenSetsCookies(e){return e.getAll().filter(e=>e.name.startsWith(this.connectionTokenSetsCookieName))}}class aY{constructor({secret:e,cookieOptions:t,enableParallelTransactions:r}){this.secret=e,this.transactionCookiePrefix=t?.prefix??"__txn_",this.cookieOptions={httpOnly:!0,sameSite:t?.sameSite??"lax",secure:t?.secure??!1,path:t?.path??"/",domain:t?.domain,maxAge:t?.maxAge||3600},this.enableParallelTransactions=r??!0}getTransactionCookieName(e){return this.enableParallelTransactions?`${this.transactionCookiePrefix}${e}`:`${this.transactionCookiePrefix}`}getCookiePrefix(){return this.transactionCookiePrefix}async save(e,t,r){if(!t.state)throw Error("Transaction state is required");if(r&&!this.enableParallelTransactions){let e=this.getTransactionCookieName(t.state);if(r.get(e))return void console.warn("A transaction is already in progress. Only one transaction is allowed when parallel transactions are disabled.")}let n=this.cookieOptions.maxAge,a=Math.floor(Date.now()/1e3+n),i=await av(t,this.secret,a);e.set(this.getTransactionCookieName(t.state),i.toString(),this.cookieOptions)}async get(e,t){let r=this.getTransactionCookieName(t),n=e.get(r)?.value;return n?aT(n,this.secret):null}async delete(e,t){aU(e,this.getTransactionCookieName(t),{domain:this.cookieOptions.domain,path:this.cookieOptions.path})}async deleteAll(e,t){let r=this.getCookiePrefix(),n={domain:this.cookieOptions.domain,path:this.cookieOptions.path};e.getAll().forEach(e=>{e.name.startsWith(r)&&aU(t,e.name,n)})}}var aZ=function(e,t,r,n,a){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r},aQ=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};x=new WeakMap;var a0=e.i(63021);let a1=globalThis.prisma??new a0.PrismaClient({log:["error"]});e.s(["prisma",0,a1],98043);let a2=new class{constructor(e={}){x.set(this,void 0),aZ(this,x,e,"f");const{domain:t,clientId:r,clientSecret:n,appBaseUrl:a,secret:i,clientAssertionSigningKey:s}=this.validateAndExtractRequiredOptions(e);this.domain=t;const o=e.clientAssertionSigningAlg||process.env.AUTH0_CLIENT_ASSERTION_SIGNING_ALG,{dpopKeyPair:c,dpopOptions:u}=function(e){let t=e.useDPoP||!1;if(!t)return{dpopKeyPair:void 0,dpopOptions:void 0};let r=e.dpopOptions?.clockTolerance??(process.env.AUTH0_DPOP_CLOCK_TOLERANCE?parseInt(process.env.AUTH0_DPOP_CLOCK_TOLERANCE,10):30);if(r>300){let e=process.env.AUTH0_DPOP_CLOCK_TOLERANCE_MAX_PROD?parseInt(process.env.AUTH0_DPOP_CLOCK_TOLERANCE_MAX_PROD,10):300;if(r>e)throw Error(`clockTolerance of ${r}s exceeds maximum allowed ${e}s in production. This could significantly weaken DPoP replay attack protection. Set AUTH0_DPOP_CLOCK_TOLERANCE_MAX_PROD environment variable to override this limit in production.`);console.warn(`WARNING: clockTolerance of ${r}s exceeds recommended maximum of 300s. This may weaken DPoP security by allowing replay attacks within a wider time window. Consider synchronizing server clocks using NTP instead of increasing tolerance.`)}let n={clockSkew:e.dpopOptions?.clockSkew??(process.env.AUTH0_DPOP_CLOCK_SKEW?parseInt(process.env.AUTH0_DPOP_CLOCK_SKEW,10):0),clockTolerance:r,retry:{delay:e.dpopOptions?.retry?.delay??(process.env.AUTH0_RETRY_DELAY?parseInt(process.env.AUTH0_RETRY_DELAY,10):100),jitter:e.dpopOptions?.retry?.jitter??(!process.env.AUTH0_RETRY_JITTER||"true"===process.env.AUTH0_RETRY_JITTER)}};if(n.retry&&"number"==typeof n.retry.delay&&n.retry.delay<0)throw Error("Retry delay must be non-negative");if(e.dpopKeyPair)return{dpopKeyPair:e.dpopKeyPair,dpopOptions:n};if(t){let e=process.env.AUTH0_DPOP_PRIVATE_KEY,t=process.env.AUTH0_DPOP_PUBLIC_KEY;if(tZ()&&(e||t))return console.warn("WARNING: Running in Edge Runtime environment. DPoP keypair loading from environment variables is not supported due to limited Node.js crypto API access. DPoP has been disabled. To use DPoP in Edge Runtime, provide a pre-generated keypair via the dpopKeyPair option."),{dpopKeyPair:void 0,dpopOptions:void 0};if(e&&t)try{let r=(0,Q.createPrivateKey)(e),a=(0,Q.createPublicKey)(t);if("ec"!==r.asymmetricKeyType)throw Error(`DPoP private key must be an Elliptic Curve key for ES256 algorithm, got: ${r.asymmetricKeyType}`);if("ec"!==a.asymmetricKeyType)throw Error(`DPoP public key must be an Elliptic Curve key for ES256 algorithm, got: ${a.asymmetricKeyType}`);let i=r.asymmetricKeyDetails,s=a.asymmetricKeyDetails;if(i?.namedCurve!=="prime256v1")throw Error(`DPoP private key must use P-256 curve (prime256v1) for ES256 algorithm, got: ${i?.namedCurve}`);if(s?.namedCurve!=="prime256v1")throw Error(`DPoP public key must use P-256 curve (prime256v1) for ES256 algorithm, got: ${s?.namedCurve}`);if(!function(e,t){if(tZ())return!0;try{let r="test-data-for-key-pair-validation",n=(0,Q.createSign)("sha256");n.update(r);let a=n.sign(e),i=(0,Q.createVerify)("sha256");if(i.update(r),!i.verify(t,a))return console.warn("WARNING: Private and public keys do not form a valid key pair - signature verification failed. Please ensure the keys are properly paired and in the correct format. DPoP will be disabled and bearer authentication will be used instead."),!1;return!0}catch(e){return console.warn(`WARNING: Failed to validate key pair compatibility. This may indicate invalid key format, mismatched algorithms, or corrupted key data. DPoP will be disabled and bearer authentication will be used instead. Error: ${e instanceof Error?e.message:String(e)}`),!1}}(r,a))return console.warn("WARNING: DPoP key pair validation failed. DPoP has been completely disabled. Falling back to bearer authentication. Please verify your key pair configuration."),{dpopKeyPair:void 0,dpopOptions:void 0};let o=r.toCryptoKey("ES256",!1,["sign"]),c=a.toCryptoKey("ES256",!1,["verify"]);return{dpopKeyPair:{privateKey:o,publicKey:c},dpopOptions:n}}catch(e){console.warn(`WARNING: Failed to load DPoP keypair from environment variables. Please ensure AUTH0_DPOP_PUBLIC_KEY and AUTH0_DPOP_PRIVATE_KEY contain valid ES256 keys in PEM format. Error: ${e instanceof Error?e.message:String(e)}`)}e&&t||console.warn("WARNING: useDPoP is set to true but dpopKeyPair is not provided. DPoP will not be used and protected requests will use bearer authentication instead. To enable DPoP, provide a dpopKeyPair in the Auth0Client options or set AUTH0_DPOP_PUBLIC_KEY and AUTH0_DPOP_PRIVATE_KEY environment variables.")}return{dpopKeyPair:void 0,dpopOptions:n}}(e),l=process.env.NEXT_PUBLIC_BASE_PATH,d={name:e.session?.cookie?.name??"__session",secure:e.session?.cookie?.secure??"true"===process.env.AUTH0_COOKIE_SECURE,sameSite:e.session?.cookie?.sameSite??process.env.AUTH0_COOKIE_SAME_SITE??"lax",path:e.session?.cookie?.path??process.env.AUTH0_COOKIE_PATH??l??"/",transient:e.session?.cookie?.transient??"true"===process.env.AUTH0_COOKIE_TRANSIENT,domain:e.session?.cookie?.domain??process.env.AUTH0_COOKIE_DOMAIN},h={prefix:e.transactionCookie?.prefix??"__txn_",secure:e.transactionCookie?.secure??!1,sameSite:e.transactionCookie?.sameSite??"lax",path:e.transactionCookie?.path??l??"/",maxAge:e.transactionCookie?.maxAge??3600};if(a){const{protocol:e}=new URL(a);"https:"===e&&(d.secure=!0,h.secure=!0)}this.routes={login:process.env.NEXT_PUBLIC_LOGIN_ROUTE||"/auth/login",logout:"/auth/logout",callback:"/auth/callback",backChannelLogout:"/auth/backchannel-logout",profile:process.env.NEXT_PUBLIC_PROFILE_ROUTE||"/auth/profile",accessToken:process.env.NEXT_PUBLIC_ACCESS_TOKEN_ROUTE||"/auth/access-token",connectAccount:"/auth/connect",...e.routes},this.transactionStore=new aY({secret:i,cookieOptions:h,enableParallelTransactions:e.enableParallelTransactions??!0}),this.sessionStore=e.sessionStore?new aV({...e.session,secret:i,store:e.sessionStore,cookieOptions:d}):new aX({...e.session,secret:i,cookieOptions:d}),this.authClient=new aL({transactionStore:this.transactionStore,sessionStore:this.sessionStore,domain:t,clientId:r,clientSecret:n,clientAssertionSigningKey:s,clientAssertionSigningAlg:o,authorizationParameters:e.authorizationParameters,pushedAuthorizationRequests:e.pushedAuthorizationRequests,appBaseUrl:a,secret:i,signInReturnToPath:e.signInReturnToPath,logoutStrategy:e.logoutStrategy,includeIdTokenHintInOIDCLogoutUrl:e.includeIdTokenHintInOIDCLogoutUrl,beforeSessionSaved:e.beforeSessionSaved,onCallback:e.onCallback,routes:this.routes,allowInsecureRequests:e.allowInsecureRequests,httpTimeout:e.httpTimeout,enableTelemetry:e.enableTelemetry,enableAccessTokenEndpoint:e.enableAccessTokenEndpoint,noContentProfileResponseWhenUnauthenticated:e.noContentProfileResponseWhenUnauthenticated,enableConnectAccountEndpoint:e.enableConnectAccountEndpoint,useDPoP:e.useDPoP||!1,dpopKeyPair:e.dpopKeyPair||c,dpopOptions:e.dpopOptions||u})}middleware(e){return this.authClient.handler.bind(this.authClient)(aq(e))}async getSession(e){if(e){if(e instanceof Request){let t=aq(e);return this.sessionStore.get(t.cookies)}return this.sessionStore.get(this.createRequestCookies(e))}return this.sessionStore.get(await (0,I.cookies)())}async getAccessToken(e,t,r){let n,a,i={refresh:!1},s={};if(e&&(e instanceof Request||"object"==typeof e.headers)){if(n=e,a=t,s={...i,...r??{}},!a)throw TypeError("getAccessToken(req, res): The 'res' argument is missing. Both 'req' and 'res' must be provided together for Pages Router or middleware usage.")}else{if(void 0!==t||void 0!==r)throw TypeError("getAccessToken: Invalid arguments. Valid signatures are getAccessToken(), getAccessToken(options), or getAccessToken(req, res, options).");s={...i,...e??{}}}return this.executeGetAccessToken(n,a,s)}async executeGetAccessToken(e,t,r){let n=e?await this.getSession(e):await this.getSession();if(!n)throw new B(g.MISSING_SESSION,"The user does not have an active session.");let[a,i]=await this.authClient.getTokenSet(n,r);if(a)throw a;let{tokenSet:s,idTokenClaims:o}=i,c=t9(n,s,{scope:aQ(this,x,"f").authorizationParameters?.scope??Z,audience:aQ(this,x,"f").authorizationParameters?.audience});if(c){o&&(n.user=o);let r=await this.authClient.finalizeSession({...n,...c},s.idToken);await this.saveToSession(r,e,t)}return{token:s.accessToken,scope:s.scope,expiresAt:s.expiresAt,token_type:s.token_type,audience:s.audience}}async getAccessTokenForConnection(e,t,r){let n=t instanceof Request?aq(t):t,a=n?await this.getSession(n):await this.getSession();if(!a)throw new F(b.MISSING_SESSION,"The user does not have an active session.");let i=a.connectionTokenSets?.find(t=>t.connection===e.connection),[s,o]=await this.authClient.getConnectionTokenSet(a.tokenSet,i,e);if(null!==s)throw s;if(o&&(!i||o.accessToken!==i.accessToken||o.expiresAt!==i.expiresAt||o.scope!==i.scope)){let t;t=i?a.connectionTokenSets?.map(t=>t.connection===e.connection?o:t):[...a.connectionTokenSets||[],o],await this.saveToSession({...a,connectionTokenSets:t},n,r)}return{token:o.accessToken,scope:o.scope,expiresAt:o.expiresAt}}async customTokenExchange(e){let[t,r]=await this.authClient.customTokenExchange(e);if(null!==t)throw t;return r}async updateSession(e,t,r){if(e instanceof Request&&!(e instanceof D.NextRequest)&&(e=aq(e)),t&&t instanceof Response&&!(t instanceof D.NextResponse)&&(t=function(e){if(e instanceof D.NextResponse)return e;let t=new Headers(e.headers),r=new D.NextResponse(e.body,{status:e.status,statusText:e.statusText,headers:t});try{"url"in e&&e.url&&(r.url=e.url)}catch{}return r}(t)),t){let n=e;if(!r)throw Error("The session data is missing.");if(n instanceof D.NextRequest&&t instanceof D.NextResponse){let e=await this.getSession(n);if(!e)throw Error("The user is not authenticated.");await this.sessionStore.set(n.cookies,t.cookies,{...r,internal:{...e.internal}})}else{let e=await this.getSession(n);if(!e)throw Error("The user is not authenticated.");let a=new Headers,i=new nz(a),s=this.createRequestCookies(n),o=t;await this.sessionStore.set(s,i,{...r,internal:{...e.internal}});let c=[],u={};for(let[e,t]of a.entries())"set-cookie"===e.toLowerCase()?c.push(t):u[e]=t;for(let[e,t]of(c.length>0&&o.setHeader("set-cookie",c),Object.entries(u)))o.setHeader(e,t)}}else{let t=await this.getSession();if(!t)throw Error("The user is not authenticated.");let r=e;if(!r)throw Error("The session data is missing.");await this.sessionStore.set(await (0,I.cookies)(),await (0,I.cookies)(),{...r,internal:{...t.internal}})}}createRequestCookies(e){let t=new Headers;for(let r in e.headers)if(Array.isArray(e.headers[r]))for(let n of e.headers[r])t.append(r,n);else t.append(r,e.headers[r]??"");return new nq(t)}async startInteractiveLogin(e={}){return this.authClient.startInteractiveLogin(e)}async getTokenByBackchannelAuth(e){let[t,r]=await this.authClient.backchannelAuthentication(e);if(t)throw t;return r}async connectAccount(e){if(!await this.getSession())throw new Y({code:A.MISSING_SESSION,message:"The user does not have an active session."});let t={audience:`${this.issuer}/me/`,scope:"create:me:connected_accounts"},r=await this.getAccessToken(t),[n,a]=await this.authClient.connectAccount({...e,tokenSet:{accessToken:r.token,expiresAt:r.expiresAt,scope:t.scope,audience:r.audience}});if(n)throw n;return a}withPageAuthRequired(t,r){let n,a,i={loginUrl:this.routes.login},s=(n=this,(t,r={})=>async a=>{let s=await n.getSession();if(!s?.user){let t="function"==typeof r.returnTo?await r.returnTo(a):r.returnTo,{redirect:n}=await e.A(74061);n(`${i.loginUrl}${t?`?returnTo=${encodeURIComponent(t)}`:""}`)}return t(a)}),o=(a=this,({getServerSideProps:e,returnTo:t}={})=>async r=>{let n=await a.getSession(r.req);if(!n?.user)return{redirect:{destination:`${i.loginUrl}?returnTo=${encodeURIComponent(t||r.resolvedUrl)}`,permanent:!1}};let s={props:{}};if(e&&(s=await e(r)),s.props instanceof Promise){let e=await s.props;return{...s,props:{user:n.user,...e}}}return{...s,props:{user:n.user,...s.props}}});return"function"==typeof t?s(t,r):o(t)}withApiAuthRequired(e){let t,r,n=(t=this,e=>async(r,n)=>{let a=await t.getSession(r);a&&a.user?await e(r,n):n.status(401).json({error:"not_authenticated",description:"The user does not have an active session or is not authenticated"})}),a=(r=this,e=>async(t,n)=>{let a=t instanceof Request?aq(t):t,i=await r.getSession();if(!i||!i.user)return D.NextResponse.json({error:"not_authenticated",description:"The user does not have an active session or is not authenticated"},{status:401});let s=await e(a,n);return s instanceof D.NextResponse?s:new D.NextResponse(s.body,s)});return(t,r)=>t instanceof Request||t.headers instanceof Headers||"boolean"==typeof t.bodyUsed?a(e)(t,r):n(e)(t,r)}async saveToSession(e,t,r){if(t&&r)if(t instanceof D.NextRequest&&r instanceof D.NextResponse)await this.sessionStore.set(t.cookies,r.cookies,e);else{let n=new Headers,a=new nz(n);for(let i of(await this.sessionStore.set(this.createRequestCookies(t),a,e),n.getSetCookie()))r.appendHeader("set-cookie",i);for(let[e,t]of n.entries())"set-cookie"!==e.toLowerCase()&&r.setHeader(e,t)}else try{await this.sessionStore.set(await (0,I.cookies)(),await (0,I.cookies)(),e)}catch(e){}}validateAndExtractRequiredOptions(e){let t={domain:e.domain??process.env.AUTH0_DOMAIN,clientId:e.clientId??process.env.AUTH0_CLIENT_ID,appBaseUrl:e.appBaseUrl??process.env.APP_BASE_URL,secret:e.secret??process.env.AUTH0_SECRET},r=e.clientSecret??process.env.AUTH0_CLIENT_SECRET,n=e.clientAssertionSigningKey??process.env.AUTH0_CLIENT_ASSERTION_SIGNING_KEY,a=Object.entries(t).filter(([,e])=>!e).map(([e])=>e);if(r||n||a.push("clientAuthentication"),a.length){let e={domain:"AUTH0_DOMAIN",clientId:"AUTH0_CLIENT_ID",appBaseUrl:"APP_BASE_URL",secret:"AUTH0_SECRET"},t="WARNING: Not all required options were provided when creating an instance of Auth0Client. Ensure to provide all missing options, either by passing it to the Auth0Client constructor, or by setting the corresponding environment variable.\n";a.forEach(r=>{"clientAuthentication"===r?t+=`Missing: clientAuthentication: Set either AUTH0_CLIENT_SECRET env var or AUTH0_CLIENT_ASSERTION_SIGNING_KEY env var, or pass clientSecret or clientAssertionSigningKey in options
`:e[r]?t+=`Missing: ${r}: Set ${e[r]} env var or pass ${r} in options
`:t+=`Missing: ${r}
`}),console.error(t.trim())}return{...t,clientSecret:r,clientAssertionSigningKey:n}}async createFetcher(e,t){let r=e instanceof Request?aq(e):e,n=r?await this.getSession(r):await this.getSession();if(!n)throw new B(g.MISSING_SESSION,"The user does not have an active session.");let a=async e=>{let[t,r]=await this.authClient.getTokenSet(n,e||{});if(t)throw t;return r.tokenSet};return await this.authClient.fetcherFactory({...t,getAccessToken:a})}get issuer(){return this.domain.startsWith("http://")||this.domain.startsWith("https://")?this.domain:`https://${this.domain}`}}({domain:process.env.AUTH0_DOMAIN,clientId:process.env.AUTH0_CLIENT_ID,clientSecret:process.env.AUTH0_CLIENT_SECRET,appBaseUrl:process.env.APP_BASE_URL,secret:process.env.AUTH0_SECRET,beforeSessionSaved:async e=>(e?.user?.email&&await a1.user.upsert({where:{auth0Id:e.user.sub},update:{email:e.user.email,name:e.user.name??null,picture:e.user.picture??null,emailVerified:e.user.email_verified??!1},create:{auth0Id:e.user.sub,email:e.user.email,name:e.user.name??null,picture:e.user.picture??null,emailVerified:e.user.email_verified??!1,hasCompletedOnboarding:!1}}),e)});e.s(["auth0",0,a2],18422)}];

//# sourceMappingURL=_a1c6891e._.js.map